!function(){"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){return[13,t,e]}function S(t,e,s,n,i,r,o,a){return[21,t,e,s,n,i,r,o,a]}function k(t,e){return[30,t,e]}function Y(t,e,s,n){return[57,t,e,s,n]}function Q(t){return[58,t]}function m(t,e,s,n){return[60,t,e,s,n]}function v(t,e){return[70,t,e]}function Z(t,e,s){return[71,t,e,s]}function tt(t,e,s,n){return[73,t,e,s,n]}function et(t,e){return[75,t,e]}function st(t,e){return[76,t,e]}function y(t,e,s,n){return[78,t,e,s,n]}function nt(t,e,s){return[113,t,e,s]}function N(t,e,s,n,i,r,o,a,c,h){return[116,t,e,s,n,i,r,o,a,c,h]}function it(t){return[117,t]}const T={htmlmasked:"hidden",masked:"obscured"},L=!("undefined"==typeof window),E=L&&navigator.userAgent.match(/firefox|fxios/i);let M=L?Date.now()-performance.now():0;const b=L&&performance.now?()=>Math.round(performance.now()+M):()=>Date.now(),O="repeat"in String.prototype?t=>"*".repeat(t.length):t=>t.replace(/./g,"*");function I(t){return t.trim().replace(/\s+/g," ")}function _(t){return t.startsWith("https://")||t.startsWith("http://")}const A="https://docs.openreplay.com",R={};function j(t,e,s="/"){R[t]||(console.warn(`OpenReplay: ${t} is deprecated. ${e?`Please, use ${e} instead.`:""} Visit ${A}${s} for more information.`),R[t]=!0)}function D(t){var e=t.getAttribute("data-openreplay-label");return null===e&&null!==(e=t.getAttribute("data-asayer-label"))&&j('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/"),e}function o(t,e){var s="data-openreplay-"+e;return t.hasAttribute(s)&&(T[e]&&j(`"${s}" attribute`,`"${T[e]}" attribute`,"/installation/sanitize-data"),1)}function C(t){return t.toString(16).padStart(2,"0")}class x{constructor(t){this.node_id=t,this.nodes=[],this.totalNodeAmount=0,this.nodeCallbacks=[],this.elementListeners=new Map}attachNodeCallback(t){this.nodeCallbacks.push(t)}attachNodeListener(e,s,n,i=!0){var r=this.getID(e);if(void 0!==r){e.addEventListener(s,n,i);let t=this.elementListeners.get(r);void 0===t&&(t=[],this.elementListeners.set(r,t)),t.push([s,n,i])}}registerNode(t){let e=t[this.node_id];var s=void 0===e;return s&&(this.totalNodeAmount++,e=this.nodes.length,(this.nodes[e]=t)[this.node_id]=e),[e,s]}unregisterNode(e){var t,s=e[this.node_id];return void 0!==s&&(delete e[this.node_id],delete this.nodes[s],void 0!==(t=this.elementListeners.get(s))&&(this.elementListeners.delete(s),t.forEach(t=>e.removeEventListener(t[0],t[1],t[2]))),this.totalNodeAmount--),s}cleanTree(){for(let t=0;t<this.nodes.length;t++){var e=this.nodes[t];e&&!document.contains(e)&&this.unregisterNode(e)}}callNodeCallbacks(e,s){this.nodeCallbacks.forEach(t=>t(e,s))}getID(t){return t[this.node_id]}getNode(t){return this.nodes[t]}getNodeCount(){return this.totalNodeAmount}clear(){for(let t=0;t<this.nodes.length;t++){var e=this.nodes[t];void 0!==e&&this.unregisterNode(e)}this.nodes.length=0}}function rt(t){return t&&null!=t.nodeType}function ot(t){return"http://www.w3.org/2000/svg"===t.namespaceURI}function d(t){return t.nodeType===Node.ELEMENT_NODE}function at(t){return t.nodeType===Node.TEXT_NODE}function H(t){return t.nodeType===Node.DOCUMENT_NODE}function p(t){return t.nodeType===Node.DOCUMENT_NODE||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function P(t,e){return t.localName===e}function ct(t){var e,s;return t.nodeType===Node.COMMENT_NODE||!(at(t)||d(t)&&("LINK"===(e=t.tagName.toUpperCase())?(s=t.getAttribute("rel"),t=t.getAttribute("as"),null!=s&&s.includes("stylesheet")||"style"===t||"font"===t):"SCRIPT"!==e&&"NOSCRIPT"!==e&&"META"!==e&&"TITLE"!==e&&"BASE"!==e))}function ht(t){return p(t)||!ct(t)}var f,n;(t=f=f||{})[t.New=0]="New",t[t.Removed=1]="Removed",t[t.Changed=2]="Changed";class ut{constructor(t,e=!1){this.app=t,this.isTopContext=e,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.observer=new MutationObserver(this.app.safe(t=>{for(const i of t){var e=i.target,s=i.type;if(ht(e))if("childList"===s){for(let t=0;t<i.removedNodes.length;t++)ht(i.removedNodes[t])&&this.bindNode(i.removedNodes[t]);for(let t=0;t<i.addedNodes.length;t++)this.bindTree(i.addedNodes[t])}else{e=this.app.nodes.getID(e);if(void 0!==e)if(this.recents.has(e)||this.recents.set(e,f.Changed),"attributes"===s){var n=i.attributeName;if(null===n)continue;let t=this.attributesMap.get(e);void 0===t&&this.attributesMap.set(e,t=new Set),t.add(n)}else"characterData"===s&&this.textSet.add(e)}}this.commitNodes()}))}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}sendNodeAttribute(t,e,s,n){ot(e)?("xlink:"===s.substr(0,6)&&(s=s.substr(6)),null===n?this.app.send(g(t,s)):"href"===s?(1e5<n.length&&(n=""),this.app.send(m(t,s,n,this.app.getBaseHref()))):this.app.attributeSender.sendSetAttribute(t,s,n)):"src"===s||"srcset"===s||"integrity"===s||"crossorigin"===s||"autocomplete"===s||"on"===s.substr(0,2)||"value"===s&&P(e,"input")&&"button"!==e.type&&"reset"!==e.type&&"submit"!==e.type||(null===n?this.app.send(g(t,s)):"style"===s||"href"===s&&P(e,"link")?this.app.send(m(t,s,n,this.app.getBaseHref())):(("href"===s||1e5<n.length)&&(n=""),this.app.attributeSender.sendSetAttribute(t,s,n)))}sendNodeData(t,e,s){P(e,"style")?this.app.send([61,t,s,this.app.getBaseHref()]):(s=this.app.sanitizer.sanitize(t,s),this.app.send([14,t,s]))}bindNode(t){var[t,e]=this.app.nodes.registerNode(t);e?this.recents.set(t,f.New):this.recents.get(t)!==f.New&&this.recents.set(t,f.Removed)}bindTree(t){if(ht(t)){this.bindNode(t);for(var e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>ct(t)||void 0!==this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);e.nextNode();)this.bindNode(e.currentNode)}}unbindTree(e){var s=this.app.nodes.unregisterNode(e);if(void 0!==s&&this.recents.get(s)===f.Removed){this.app.send([11,s]);var n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>ct(t)||void 0===this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let t=0;for(s=this.app.nodes.getNodeCount();n.nextNode();)t+=1,this.app.nodes.unregisterNode(n.currentNode);e=Math.floor(t/s*100);30<e&&this.app.send([115,e])}}_commitNode(s,n){if(!p(n)){var i=n.parentNode;let t;if(!P(n,"html")||!this.isTopContext){if(null===i)return this.unbindTree(n),!1;if(void 0===(t=this.app.nodes.getID(i)))return this.unbindTree(n),!1;if(!this.commitNode(t))return this.unbindTree(n),!1;if(this.app.sanitizer.handleNode(s,t,n),this.app.sanitizer.isHidden(t))return!1}let e=n.previousSibling;for(;null!==e;){var r=this.app.nodes.getID(e);if(void 0!==r){this.commitNode(r),this.indexes[s]=this.indexes[r]+1;break}e=e.previousSibling}null===e&&(this.indexes[s]=0);var o,a=this.recents.get(s),c=a===f.New,h=this.indexes[s];if(void 0===h)throw"commitNode: missing node index";if(c)if(d(n)){let e=n;void 0!==t&&(this.app.sanitizer.isHidden(s)&&(c=e.clientWidth,o=e.clientHeight,(e=n.cloneNode()).style.width=c+"px",e.style.height=o+"px"),this.app.send([8,s,t,h,e.tagName,ot(n)]));for(let t=0;t<e.attributes.length;t++){const u=e.attributes[t];this.sendNodeAttribute(s,e,u.nodeName,u.value)}}else at(n)&&(this.app.send([9,s,t,h]),this.sendNodeData(s,i,n.data));else{a===f.Removed&&void 0!==t&&this.app.send([10,s,t,h]);const u=this.attributesMap.get(s);if(void 0!==u){if(!d(n))throw"commitNode: node is not an element";for(const l of u)this.sendNodeAttribute(s,n,l,n.getAttribute(l))}if(this.textSet.has(s)){if(!at(n))throw"commitNode: node is not a text";this.sendNodeData(s,i,n.data)}}}return!0}commitNode(t){var e,s=this.app.nodes.getNode(t);return void 0!==s&&(void 0!==(e=this.commited[t])?e:this.commited[t]=this._commitNode(t,s))}commitNodes(s=!1){let n;this.recents.forEach((t,e)=>{this.commitNode(e),t===f.New&&(n=this.app.nodes.getNode(e))&&this.app.nodes.callNodeCallbacks(n,s)}),this.clear()}observeRoot(t,e,s=t){this.observer.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(s),e(this.app.nodes.getID(t)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class lt extends ut{observe(t){var e=t.contentDocument;const s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,t=>{void 0===t?console.log("OpenReplay: Iframe document not bound"):this.app.send(v(s,t))})}}class dt extends ut{observe(t){var e=t.shadowRoot;const s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,t=>{void 0===t?console.log("OpenReplay: Shadow Root was not bound"):this.app.send(v(s,t))})}}class pt{constructor(){this.states=new Map}calcOffset(t){let e=0,s=0;if(t.parent&&([e,s]=this.calcOffset(t.parent)),!t.offset){const{left:n,top:i}=t.iFrame.getBoundingClientRect();t.offset=[n,i]}const[n,i]=t.offset;return[e+n,s+i]}getDocumentOffset(t){t=this.states.get(t);return t?this.calcOffset(t):[0,0]}observe(t){var e=t.contentDocument;if(!e)return;const s=t.ownerDocument,n={offset:null,iFrame:t,parent:this.states.get(s)||null,clear:()=>{var t;s.removeEventListener("scroll",i),null!=(t=s.defaultView)&&t.removeEventListener("resize",i)}},i=()=>{n.offset=null};s.addEventListener("scroll",i),null!=(t=s.defaultView)&&t.addEventListener("resize",i),this.states.set(e,n)}clear(){this.states.forEach(t=>t.clear()),this.states.clear()}}const ft=L?Element.prototype.attachShadow:()=>new ShadowRoot;class gt extends ut{constructor(t,e){super(t,!0),this.iframeOffsets=new pt,this.contextCallbacks=[],this.contextsSet=new Set,this.iframeObservers=[],this.shadowRootObservers=[],this.options=Object.assign({captureIFrames:!0},e),this.app.nodes.attachNodeCallback(t=>{P(t,"iframe")&&(this.options.captureIFrames&&!o(t,"obscured")||o(t,"capture"))&&this.handleIframe(t)}),this.app.nodes.attachNodeCallback(t=>{d(t)&&null!==t.shadowRoot&&this.handleShadowRoot(t.shadowRoot)})}attachContextCallback(t){this.contextCallbacks.push(t)}getDocumentOffset(t){return this.iframeOffsets.getDocumentOffset(t)}handleIframe(n){let i=null;var t=this.app.safe(()=>setTimeout(()=>{var t=this.app.nodes.getID(n);if(void 0!==t&&function(t){try{return Boolean(t.contentDocument)}catch(t){}}(n)){const s=n.contentWindow;var e,t=n.contentDocument;t&&t!==i&&(e=new lt(this.app),this.iframeObservers.push(e),e.observe(n),i=t,this.iframeOffsets.observe(n)),s&&s===s.window&&!this.contextsSet.has(s)&&(this.contextsSet.add(s),this.contextCallbacks.forEach(t=>t(s)))}},0));n.addEventListener("load",t),t()}handleShadowRoot(t){var e=new dt(this.app);this.shadowRootObservers.push(e),e.observe(t.host)}observe(){const e=this;Element.prototype.attachShadow=function(){var t=ft.apply(this,arguments);return e.handleShadowRoot(t),t},this.observeRoot(window.document,()=>{this.app.send([7]),this.app.nodes.callNodeCallbacks(document,!0)},window.document.documentElement)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=ft,this.iframeObservers.forEach(t=>t.disconnect()),this.iframeObservers=[],this.shadowRootObservers.forEach(t=>t.disconnect()),this.shadowRootObservers=[],super.disconnect()}}(t=n=n||{})[t.Plain=0]="Plain",t[t.Obscured=1]="Obscured",t[t.Hidden=2]="Hidden";class mt{constructor(t,e){this.app=t,this.obscured=new Set,this.hidden=new Set,this.options=Object.assign({obscureTextEmails:!0,obscureTextNumbers:!1},e)}handleNode(t,e,s){(this.obscured.has(e)||d(s)&&(o(s,"masked")||o(s,"obscured")))&&this.obscured.add(t),(this.hidden.has(e)||d(s)&&(o(s,"htmlmasked")||o(s,"hidden")))&&this.hidden.add(t),void 0!==this.options.domSanitizer&&d(s)&&((e=this.options.domSanitizer(s))===n.Obscured&&this.obscured.add(t),e===n.Hidden)&&this.hidden.add(t)}sanitize(t,e){return this.obscured.has(t)?e.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/g,"â–ˆ"):(this.options.obscureTextNumbers&&(e=e.replace(/\d/g,"0")),this.options.obscureTextEmails?e.replace(/^\w+([.-]\w+)*@\w+([.-]\w+)*\.\w{2,3}$/g,t=>{var[t,e]=t.split("@"),[e,s]=e.split(".");return`${O(t)}@${O(e)}.`+O(s)}):e)}isObscured(t){return this.obscured.has(t)}isHidden(t){return this.hidden.has(t)}getInnerTextSecure(t){var e=this.app.nodes.getID(t);return e?this.sanitize(e,t.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class vt{constructor(t){this.app=t,this.timer=null,this.callbacks=[]}attach(t,e=0,s=!0,n){n&&(t=t.bind(n)),s&&(t=this.app.safe(t)),this.callbacks.unshift(e?function(t,e){let s=0;return()=>{s++>=e&&(s=0,t())}}(t,e):t)}start(){null===this.timer&&(this.timer=setInterval(()=>this.callbacks.forEach(t=>{t&&t()}),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}const r={Verbose:5,Log:4,Warnings:3,Errors:2,Silent:0};function yt(t){return"object"==typeof t}class bt{constructor(t=r.Silent){this.options=!0===t?{level:r.Verbose}:"number"==typeof t?{level:t}:t}log(...t){(yt(this.options.level)?this.options.level.log:this.options.level>=r.Log)&&console.log(...t)}warn(...t){(yt(this.options.level)?this.options.level.warn:this.options.level>=r.Warnings)&&console.warn(...t)}error(...t){(yt(this.options.level)?this.options.level.error:this.options.level>=r.Errors)&&console.error(...t)}}class St{constructor(t,e){this.app=t,this.options=e,this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0,this.createTabId()}attachUpdateCallback(t){this.callbacks.push(t)}handleUpdate(e){null==e.userID&&delete e.userID,null==e.sessionID&&delete e.sessionID,this.callbacks.forEach(t=>t(e))}assign(t){void 0!==t.userID&&(this.userID=t.userID),void 0!==t.metadata&&Object.entries(t.metadata).forEach(([t,e])=>this.metadata[t]=e),void 0!==t.sessionID&&(this.sessionID=t.sessionID),void 0!==t.timestamp&&(this.timestamp=t.timestamp),void 0!==t.projectID&&(this.projectID=t.projectID),this.handleUpdate(t)}setMetadata(t,e){this.metadata[t]=e,this.handleUpdate({metadata:{[t]:e}})}setUserID(t){this.userID=t,this.handleUpdate({userID:t})}setUserInfo(t){this.userInfo=t}getPageNumber(){var t=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=t)return parseInt(t)}incPageNo(){let t=this.getPageNumber();return void 0===t?t=0:t++,this.app.sessionStorage.setItem(this.options.session_pageno_key,t.toString()),t}getSessionToken(){return this.app.sessionStorage.getItem(this.options.session_token_key)||void 0}setSessionToken(t){this.app.sessionStorage.setItem(this.options.session_token_key,t)}applySessionHash(t){var e=decodeURI(t).split("&");let s=t,n="100500";2==e.length&&([n,s]=e),n&&s&&(this.app.sessionStorage.setItem(this.options.session_token_key,s),this.app.sessionStorage.setItem(this.options.session_pageno_key,n))}getSessionHash(){var t=this.getPageNumber(),e=this.getSessionToken();if(void 0!==t&&void 0!==e)return encodeURI(String(t)+"&"+e)}getTabId(){return this.tabId||this.createTabId(),this.tabId}createTabId(){var t=this.app.sessionStorage.getItem(this.options.session_tabid_key);t?this.tabId=t:(t=12,t=new Uint8Array((t||40)/2),(window.crypto||window.msCrypto).getRandomValues(t),t=Array.from(t,C).join(""),this.app.sessionStorage.setItem(this.options.session_tabid_key,t),this.tabId=t)}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}function wt(t,e){for(var s=new $(31),n=0;n<31;++n)s[n]=e+=1<<t[n-1];for(var i=new J(s[30]),n=1;n<30;++n)for(var r=s[n];r<s[n+1];++r)i[r]=r-s[n]<<5|n;return[s,i]}var kt={},X=Uint8Array,$=Uint16Array,J=Uint32Array,K=new X([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),V=new X([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Nt=new X([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=wt(K,2),e=t[0],G=t[1];e[28]=258,G[258]=28;for(var Tt=wt(V,0)[1],Et=new $(32768),s=0;s<32768;++s){var i=(43690&s)>>>1|(21845&s)<<1;Et[s]=((65280&(i=(61680&(i=(52428&i)>>>2|(13107&i)<<2))>>>4|(3855&i)<<4))>>>8|(255&i)<<8)>>>1}for(var U=function(t,e,s){for(var n=t.length,i=0,r=new $(e);i<n;++i)t[i]&&++r[t[i]-1];var o=new $(e);for(i=0;i<e;++i)o[i]=o[i-1]+r[i-1]<<1;if(s){for(var a=new $(1<<e),c=15-e,i=0;i<n;++i)if(t[i])for(var h=i<<4|t[i],u=e-t[i],l=o[t[i]-1]++<<u,d=l|(1<<u)-1;l<=d;++l)a[Et[l]>>>c]=h}else for(a=new $(n),i=0;i<n;++i)t[i]&&(a[i]=Et[o[t[i]-1]++]>>>15-t[i]);return a},F=new X(288),s=0;s<144;++s)F[s]=8;for(s=144;s<256;++s)F[s]=9;for(s=256;s<280;++s)F[s]=7;for(s=280;s<288;++s)F[s]=8;for(var z=new X(32),s=0;s<32;++s)z[s]=5;function Ot(t,e,s){for(var n=t(),i=(t=t.toString()).slice(t.indexOf("[")+1,t.lastIndexOf("]")).replace(/\s+/g,"").split(","),r=0;r<n.length;++r){var o=n[r],a=i[r];if("function"==typeof o){e+=";"+a+"=";var c=o.toString();if(o.prototype)if(-1!=c.indexOf("[native code]")){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else for(var u in e+=c,o.prototype)e+=";"+a+".prototype."+u+"="+o.prototype[u].toString();else e+=c}else s[a]=o}return[e,s]}function It(){return[X,$,J,K,V,Nt,G,Tt,Rt,F,Dt,z,Et,Ft,zt,U,q,B,At,jt,Ht,W,Pt,Ut,Ct,xt,qt,Xt,Qt,Kt]}function _t(){return[Gt,Yt,Vt,Wt,Bt]}var Rt=U(F,9,0),Dt=U(z,5,0),Ct=function(t){return(t+7)/8|0},xt=function(t,e,s){(null==s||s>t.length)&&(s=t.length);var n=new(2==t.BYTES_PER_ELEMENT?$:4==t.BYTES_PER_ELEMENT?J:X)(s-(e=null==e||e<0?0:e));return n.set(t.subarray(e,s)),n},Lt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Mt=function(t,e,s){e=new Error(e||Lt[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,Mt),s)return e;throw e},q=function(t,e,s){var n=e/8|0;t[n]|=s<<=7&e,t[1+n]|=s>>>8},B=function(t,e,s){var n=e/8|0;t[n]|=s<<=7&e,t[1+n]|=s>>>8,t[2+n]|=s>>>16},At=function(t,e){for(var s=[],n=0;n<t.length;++n)t[n]&&s.push({s:n,f:t[n]});var i=s.length,r=s.slice();if(!i)return[zt,0];if(1==i)return(g=new X(s[0].s+1))[s[0].s]=1,[g,1];s.sort(function(t,e){return t.f-e.f}),s.push({s:-1,f:25001});var o=s[0],a=s[1],c=0,h=1,u=2;for(s[0]={s:-1,f:o.f+a.f,l:o,r:a};h!=i-1;)o=s[s[c].f<s[u].f?c++:u++],a=s[c!=h&&s[c].f<s[u].f?c++:u++],s[h++]={s:-1,f:o.f+a.f,l:o,r:a};for(var l=r[0].s,n=1;n<i;++n)r[n].s>l&&(l=r[n].s);var d=new $(l+1),p=jt(s[h-1],d,0);if(e<p){var n=0,f=0,g=p-e,m=1<<g;for(r.sort(function(t,e){return d[e.s]-d[t.s]||t.f-e.f});n<i;++n){var v=r[n].s;if(!(d[v]>e))break;f+=m-(1<<p-d[v]),d[v]=e}for(f>>>=g;0<f;){var y=r[n].s;d[y]<e?f-=1<<e-d[y]++-1:++n}for(;0<=n&&f;--n){var b=r[n].s;d[b]==e&&(--d[b],++f)}p=e}return[new X(d),p]},jt=function(t,e,s){return-1==t.s?Math.max(jt(t.l,e,s+1),jt(t.r,e,s+1)):e[t.s]=s},Ht=function(t){for(var e=t.length;e&&!t[--e];);for(var s=new $(++e),n=0,i=t[0],r=1,o=function(t){s[n++]=t},a=1;a<=e;++a)if(t[a]==i&&a!=e)++r;else{if(!i&&2<r){for(;138<r;r-=138)o(32754);2<r&&(o(10<r?r-11<<5|28690:r-3<<5|12305),r=0)}else if(3<r){for(o(i),--r;6<r;r-=6)o(8304);2<r&&(o(r-3<<5|8208),r=0)}for(;r--;)o(i);r=1,i=t[a]}return[s.subarray(0,n),e]},W=function(t,e){for(var s=0,n=0;n<e.length;++n)s+=t[n]*e[n];return s},Pt=function(t,e,s){var n=s.length,i=Ct(e+2);t[i]=255&n,t[i+1]=n>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var r=0;r<n;++r)t[i+r+4]=s[r];return 8*(i+4+n)},Ut=function(t,e,s,n,i,r,o,a,c,h,u){q(e,u++,s),++i[256];for(var s=At(i,15),l=s[0],s=s[1],d=At(r,15),p=d[0],d=d[1],f=Ht(l),g=f[0],f=f[1],m=Ht(p),v=m[0],m=m[1],y=new $(19),b=0;b<g.length;++b)y[31&g[b]]++;for(b=0;b<v.length;++b)y[31&v[b]]++;for(var S=At(y,7),w=S[0],S=S[1],k=19;4<k&&!w[Nt[k-1]];--k);var N=h+5<<3,T=W(i,F)+W(r,z)+o,i=W(i,l)+W(r,p)+o+14+3*k+W(y,w)+(2*y[16]+3*y[17]+7*y[18]);if(N<=T&&N<=i)return Pt(e,u,t.subarray(c,c+h));if(q(e,u,1+(i<T)),u+=2,i<T){var E=U(l,s,0),O=l,I=U(p,d,0),_=p,R=U(w,S,0);q(e,u,f-257),q(e,u+5,m-1),q(e,u+10,k-4),u+=14;for(b=0;b<k;++b)q(e,u+3*b,w[Nt[b]]);u+=3*k;for(var D=[g,v],C=0;C<2;++C)for(var x=D[C],b=0;b<x.length;++b){var L=31&x[b];q(e,u,R[L]),u+=w[L],15<L&&(q(e,u,x[b]>>>5&127),u+=x[b]>>>12)}}else E=Rt,O=F,I=Dt,_=z;for(var M,b=0;b<a;++b)255<n[b]?(L=n[b]>>>18&31,B(e,u,E[L+257]),u+=O[L+257],7<L&&(q(e,u,n[b]>>>23&31),u+=K[L]),M=31&n[b],B(e,u,I[M]),u+=_[M],3<M&&(B(e,u,n[b]>>>5&8191),u+=V[M])):(B(e,u,E[n[b]]),u+=O[n[b]]);return B(e,u,E[256]),u+O[256]},Ft=new J([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zt=new X(0),qt=function(e,t,s,n,i,r){var o=e.length,a=new X(n+o+5*(1+Math.ceil(o/7e3))+i),c=a.subarray(n,a.length-i),h=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var l=u+65535;o<=l&&(c[h>>3]=r),h=Pt(c,h+1,e.subarray(u,l))}else{for(var t=Ft[t-1],j=t>>>13,H=8191&t,d=(1<<s)-1,p=new $(32768),f=new $(1+d),g=Math.ceil(s/3),P=2*g,m=function(t){return(e[t]^e[t+1]<<g^e[t+2]<<P)&d},v=new J(25e3),y=new $(288),b=new $(32),S=0,w=0,u=0,k=0,N=0,T=0;u<o;++u){var E=m(u),O=32767&u,I=f[E];if(p[O]=I,f[E]=O,N<=u){var _=o-u;if((7e3<S||24576<k)&&423<_){for(var h=Ut(e,c,0,v,y,b,w,k,T,u-T,h),k=S=w=0,T=u,R=0;R<286;++R)y[R]=0;for(R=0;R<30;++R)b[R]=0}var D=2,C=0,U=H,x=O-I&32767;if(2<_&&E==m(u-x))for(var F=Math.min(j,_)-1,z=Math.min(32767,u),q=Math.min(258,_);x<=z&&--U&&O!=I;){if(e[u+D]==e[u+D-x]){for(var L=0;L<q&&e[u+L]==e[u+L-x];++L);if(D<L){if(C=x,F<(D=L))break;for(var B=Math.min(x,L-2),M=0,R=0;R<B;++R){var A=u-x+R+32768&32767,W=A-p[A]+32768&32767;M<W&&(M=W,I=A)}}}x+=(O=I)-(I=p[O])+32768&32767}C?(v[k++]=268435456|G[D]<<18|Tt[C],E=31&G[D],_=31&Tt[C],w+=K[E]+V[_],++y[257+E],++b[_],N=u+D,++S):(v[k++]=e[u],++y[e[u]])}}h=Ut(e,c,r,v,y,b,w,k,T,u-T,h),!r&&7&h&&(h=Pt(c,h+1,zt))}return xt(a,0,n+Ct(h)+i)},Bt=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var s=e,n=9;--n;)s=(1&s&&-306674912)^s>>>1;t[e]=s}return t}(),Wt=function(){var n=-1;return{p:function(t){for(var e=n,s=0;s<t.length;++s)e=Bt[255&e^t[s]]^e>>>8;n=e},d:function(){return~n}}},Xt=function(t,e,s,n,i){return qt(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,s,n,!i)},$t=[],Jt=function(t,e,s,n){var i;if(!$t[s]){for(var r="",o={},a=t.length-1,c=0;c<a;++c)r=(i=Ot(t[c],r,o))[0],o=i[1];$t[s]=Ot(t[a],r,o)}var h=function(t,e){var s,n={};for(s in t)n[s]=t[s];for(s in e)n[s]=e[s];return n}({},$t[s][1]),e=$t[s][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",u=h,h=function(t){var e,s=[];for(e in t)t[e].buffer&&s.push((t[e]=new t[e].constructor(t[e])).buffer);return s}(h),l=n;return(s=new Worker(kt[s]||(kt[s]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))))).onmessage=function(t){var e,t=t.data,s=t.$e$;s?((e=new Error(s[0])).code=s[1],e.stack=s[2],l(e,null)):l(null,t)},s.postMessage(u,h),s},Kt=function(t){return postMessage(t,[t.buffer])},Vt=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8},Gt=function(t,e){var s=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&Vt(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),s){t[3]=8;for(var n=0;n<=s.length;++n)t[n+10]=s.charCodeAt(n)}},Yt=function(t){return 10+(t.filename&&t.filename.length+1||0)};function Qt(t,e){return Xt(t,e||{},0,0)}function Zt(t,e,s){var n,i;s||(s=e,e={}),"function"!=typeof s&&Mt(7),t=t,e=e,n=s,(i=Jt([It,_t,function(){return[te]}],function(t){return Kt(te(t.data[0],t.data[1]))},2,function(t,e){i.terminate(),n(t,e)})).postMessage([t,e],e.consume?[t.buffer]:[])}function te(t,e){e=e||{};var s=Wt(),n=t.length,t=(s.p(t),Xt(t,e,Yt(e),8)),i=t.length;return Gt(t,e),Vt(t,i-8,s.d()),Vt(t,i-4,n),t}var w,t="undefined"!=typeof TextDecoder&&new TextDecoder;try{t.decode(zt,{stream:!0})}catch(t){}const ee=L&&"performance"in window&&"memory"in performance?performance:{memory:{}},se=L?1024*(navigator.deviceMemory||0):0,ne=ee.memory.jsHeapSizeLimit||0;class ie{constructor(){this.idx=1,this.backDict={}}getKey(t){let e=!1;return this.backDict[t]||(e=!0,this.backDict[t]=this.idx++),[this.backDict[t],e]}}class re{constructor(t,e){this.app=t,this.isDictDisabled=e,this.dict=new ie}sendSetAttribute(t,e,s){this.isDictDisabled&&this.app.send([12,t,e,s]);t=[51,t,this.applyDict(e),this.applyDict(s)];this.app.send(t)}applyDict(t){var[e,s]=this.dict.getKey(t);return s&&this.app.send([50,e,t]),e}clear(){this.dict=new ie}}const oe="canceled",ae=t=>({reason:t,success:!1}),ce=((e=w=w||{})[e.NotActive=0]="NotActive",e[e.Starting=1]="Starting",e[e.Active=2]="Active","https://api.openreplay.com/ingest");class he{constructor(t,e,s){this.messages=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=w.NotActive,this.version="9.0.0",this.compressionThreshold=24e3,this.restartAttempts=0,this.bc=null,this._usingOldFetchPlugin=!1,this.delay=0,this.projectKey=t,this.networkOptions=s.network,this.options=Object.assign({revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",session_tabid_key:"__openreplay_tabid",local_uuid_key:"__openreplay_uuid",ingestPoint:ce,resourceBaseHref:null,verbose:!1,__is_snippet:!1,__debug_report_edp:null,localStorage:null,sessionStorage:null,disableStringDict:!1,forceSingleTab:!1},s),!this.options.forceSingleTab&&globalThis&&"BroadcastChannel"in globalThis&&(this.bc=new BroadcastChannel("rick")),this.revID=this.options.revID,this.localStorage=null!=(t=this.options.localStorage)?t:window.localStorage,this.sessionStorage=null!=(t=this.options.sessionStorage)?t:window.sessionStorage,this.sanitizer=new mt(this,s),this.nodes=new x(this.options.node_id),this.observer=new gt(this,s),this.ticker=new vt(this),this.ticker.attach(()=>this.commit()),this.debug=new bt(this.options.__debug__),this.notify=new bt(this.options.verbose?r.Warnings:r.Silent),this.session=new St(this,this.options),this.attributeSender=new re(this,Boolean(this.options.disableStringDict)),this.session.attachUpdateCallback(({userID:t,metadata:e})=>{null!=t&&this.send([28,t]),null!=e&&Object.entries(e).forEach(([t,e])=>this.send(k(t,e)))}),null!=e&&this.session.applySessionHash(e);try{this.worker=new Worker(URL.createObjectURL(new Blob(['"use strict";class t{constructor(t,i,s,e=10,n=1e3,r){this.onUnauthorised=i,this.onFailure=s,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.onCompress=r,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.ingestURL=t+"/v1/web/i",this.isCompressing=void 0!==r}authorise(t){this.token=t,this.busy||this.sendNext()}push(t){this.busy||!this.token?this.queue.push(t):(this.busy=!0,this.isCompressing&&this.onCompress?this.onCompress(t):this.sendBatch(t))}sendNext(){const t=this.queue.shift();t?(this.busy=!0,this.isCompressing&&this.onCompress?this.onCompress(t):this.sendBatch(t)):this.busy=!1}retry(t,i){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout(()=>this.sendBatch(t,i),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t,i){this.busy=!0;const s={Authorization:"Bearer "+this.token};i&&(s["Content-Encoding"]="gzip"),null!==this.token?fetch(this.ingestURL,{body:t,method:"POST",headers:s,keepalive:t.length<65536}).then(s=>{if(401===s.status)return this.busy=!1,void this.onUnauthorised();s.status>=400?this.retry(t,i):(this.attemptsCount=0,this.sendNext())}).catch(s=>{console.warn("OpenReplay:",s),this.retry(t,i)}):setTimeout(()=>{this.sendBatch(t,i)},500)}sendCompressed(t){this.sendBatch(t,!0)}sendUncompressed(t){this.sendBatch(t,!1)}clean(){this.sendNext(),setTimeout(()=>{this.token=null,this.queue.length=0},10)}}const i="function"==typeof TextEncoder?new TextEncoder:{encode(t){const i=t.length,s=new Uint8Array(3*i);let e=-1;for(let n=0,r=0,h=0;h!==i;){if(n=t.charCodeAt(h),h+=1,n>=55296&&n<=56319){if(h===i){s[e+=1]=239,s[e+=1]=191,s[e+=1]=189;break}if(r=t.charCodeAt(h),!(r>=56320&&r<=57343)){s[e+=1]=239,s[e+=1]=191,s[e+=1]=189;continue}if(n=1024*(n-55296)+r-56320+65536,h+=1,n>65535){s[e+=1]=240|n>>>18,s[e+=1]=128|n>>>12&63,s[e+=1]=128|n>>>6&63,s[e+=1]=128|63&n;continue}}n<=127?s[e+=1]=0|n:n<=2047?(s[e+=1]=192|n>>>6,s[e+=1]=128|63&n):(s[e+=1]=224|n>>>12,s[e+=1]=128|n>>>6&63,s[e+=1]=128|63&n)}return s.subarray(0,e+1)}};class s extends class{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}get isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,i){this.data.set(t,i)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const s=i.encode(t),e=s.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(s,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}{encode(t){switch(t[0]){case 0:return this.uint(t[1]);case 4:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 11:return this.uint(t[1]);case 12:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 17:return this.uint(t[1])&&this.string(t[2]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 20:return this.uint(t[1])&&this.uint(t[2]);case 21:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8]);case 22:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 24:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 27:return this.string(t[1])&&this.string(t[2]);case 28:case 29:return this.string(t[1]);case 30:return this.string(t[1])&&this.string(t[2]);case 37:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3]);case 38:return this.uint(t[1])&&this.uint(t[2]);case 39:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 41:return this.string(t[1])&&this.string(t[2]);case 42:return this.string(t[1]);case 44:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 45:case 46:return this.string(t[1])&&this.string(t[2]);case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 50:return this.uint(t[1])&&this.string(t[2]);case 51:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 54:return this.uint(t[1])&&this.string(t[2]);case 55:return this.boolean(t[1]);case 57:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:return this.int(t[1]);case 59:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6])&&this.string(t[7]);case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 61:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 63:case 64:return this.string(t[1])&&this.string(t[2]);case 67:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 70:return this.uint(t[1])&&this.uint(t[2]);case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 75:case 76:case 77:return this.uint(t[1])&&this.uint(t[2]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 79:return this.string(t[1])&&this.string(t[2]);case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 82:return this.uint(t[1])&&this.uint(t[2]);case 112:return this.uint(t[1])&&this.string(t[2])&&this.boolean(t[3])&&this.string(t[4])&&this.int(t[5])&&this.int(t[6]);case 113:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3]);case 114:case 115:return this.uint(t[1]);case 116:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8])&&this.uint(t[9])&&this.boolean(t[10]);case 117:case 118:return this.string(t[1])}}}class e{constructor(t,i,e,n,r){this.pageNo=t,this.timestamp=i,this.url=e,this.onBatch=n,this.tabId=r,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new s(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,i){for(let i=0;i<3;i++)this.sizeBuffer[i]=t>>8*i;this.encoder.set(this.sizeBuffer,i)}prepare(){if(!this.encoder.isEmpty)return;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url],i=[118,this.tabId];this.writeType(t),this.writeFields(t),this.writeWithSize(i),this.isEmpty=!0}writeWithSize(t){const i=this.encoder;if(!this.writeType(t)||!i.skip(3))return!1;const s=i.getCurrentOffset(),e=this.writeFields(t);if(e){const e=i.getCurrentOffset()-s;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,s-3),i.checkpoint(),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){0===t[0]&&(this.timestamp=t[1]),4===t[0]&&(this.url=t[1]),this.writeWithSize(t)||(this.finaliseBatch(),this.writeWithSize(t)||(this.encoder=new s(this.beaconSizeLimit),this.prepare(),this.writeWithSize(t)?this.finaliseBatch():console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder=new s(this.beaconSize),this.prepare()))}finaliseBatch(){if(this.isEmpty)return;const t=this.encoder.flush();this.onBatch(t),this.prepare()}clean(){this.encoder.reset()}}var n;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active",t[t.Stopped=4]="Stopped"}(n||(n={}));let r=null,h=null,u=n.NotActive;function a(){h&&h.finaliseBatch()}function o(){u=n.Stopping,null!==p&&(clearInterval(p),p=null),h&&(h.clean(),h=null),r&&(r.clean(),setTimeout(()=>{r=null},20)),setTimeout(()=>{u=n.NotActive},100)}function c(){u!==n.Stopped&&(postMessage("restart"),o())}let g,p=null;self.onmessage=({data:i})=>{if(null!=i){if("stop"===i)return a(),o(),u=n.Stopped;if("forceFlushBatch"!==i){if(!Array.isArray(i)){if("compressed"===i.type){if(!r)return console.debug("WebWorker: sender not initialised. Compressed batch."),void c();r.sendCompressed(i.batch)}if("uncompressed"===i.type){if(!r)return console.debug("WebWorker: sender not initialised. Uncompressed batch."),void c();r.sendUncompressed(i.batch)}return"start"===i.type?(u=n.Starting,r=new t(i.ingestPoint,()=>{c()},t=>{!function(t){postMessage({type:"failure",reason:t}),o()}(t)},i.connAttemptCount,i.connAttemptGap,t=>{postMessage({type:"compress",batch:t},[t.buffer])}),h=new e(i.pageNo,i.timestamp,i.url,t=>r&&r.push(t),i.tabId),null===p&&(p=setInterval(a,1e4)),u=n.Active):"auth"===i.type?r?h?(r.authorise(i.token),void(i.beaconSizeLimit&&h.setBeaconSizeLimit(i.beaconSizeLimit))):(console.debug("WebWorker: writer not initialised. Received auth."),void c()):(console.debug("WebWorker: sender not initialised. Received auth."),void c()):void 0}if(null!==h){const t=h;i.forEach(i=>{55===i[0]&&(i[1]?g=setTimeout(()=>c(),18e5):clearTimeout(g)),t.writeMessage(i)})}h||(postMessage("not_init"),c())}else a()}else a()};'],{type:"text/javascript"}))),this.worker.onerror=t=>{this._debug("webworker_error",t)},this.worker.onmessage=({data:t})=>{var e;"restart"===t?(this.stop(!1),this.start({},!0)):"not_init"===t?console.warn("WebWorker: writer not initialised. Restarting tracker"):"failure"===t.type?(this.stop(!1),this._debug("worker_failed",t.reason)):"compress"===t.type&&((e=t.batch).byteLength>this.compressionThreshold?Zt(t.batch,{mtime:0},(t,e)=>{t&&(console.error("Openreplay compression error:",t),this.stop(!1),this.restartAttempts<3)&&(this.restartAttempts+=1,this.start({},!0)),null!=(t=this.worker)&&t.postMessage({type:"compressed",batch:e})}):null!=(t=this.worker)&&t.postMessage({type:"uncompressed",batch:e}))};var n=()=>{this.worker&&this.worker.postMessage(null)};this.attachEventListener(window,"beforeunload",n,!1),this.attachEventListener(document.body,"mouseleave",n,!1,!1),this.attachEventListener(document,"visibilitychange",n,!1)}catch(t){this._debug("worker_start",t)}const i=this.session.getTabId();!this.session.getSessionToken()&&this.bc&&this.bc.postMessage({line:"never-gonna-give-you-up",source:i}),this.bc&&(this.bc.onmessage=t=>{var e,s;t.data.source!==i&&("never-gonna-let-you-down"===t.data.line&&(e=t.data.token,this.session.setSessionToken(e)),"never-gonna-give-you-up"===t.data.line)&&(s=this.session.getSessionToken())&&this.bc&&this.bc.postMessage({line:"never-gonna-let-you-down",token:s,source:i})})}_debug(t,e){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:t,error:""+e})}),this.debug.error("OpenReplay error: ",t,e)}send(t,e=!1){this.activityState===w.NotActive||(39===t[0]&&(this._usingOldFetchPlugin=!0,j("Fetch plugin","'network' init option","/installation/network-options"),j("Axios plugin","'network' init option","/installation/network-options")),this._usingOldFetchPlugin&&21===t[0])||(this.messages.push(t),this.activityState===w.Active&&e&&this.commit())}commit(){this.worker&&this.messages.length&&(this.messages.unshift([118,this.session.getTabId()]),this.messages.unshift([0,this.timestamp()]),this.worker.postMessage(this.messages),this.commitCallbacks.forEach(t=>t(this.messages)),this.messages.length=0)}timestamp(){return b()+this.delay}safe(e){const s=this;return function(...t){try{e.apply(this,t)}catch(t){s._debug("safe_fn_call",t)}}}attachCommitCallback(t){this.commitCallbacks.push(t)}attachStartCallback(t,e=!1){e&&(t=this.safe(t)),this.startCallbacks.push(t)}attachStopCallback(t,e=!1){e&&(t=this.safe(t)),this.stopCallbacks.push(t)}attachEventListener(t,e,s,n=!0,i=!0){n&&(s=this.safe(s)),this.attachStartCallback(()=>null==t?void 0:t.addEventListener(e,s,i),n),this.attachStopCallback(()=>null==t?void 0:t.removeEventListener(e,s,i),n)}checkRequiredVersion(t){var e=t.split(/[.-]/),s=this.version.split(/[.-]/);for(let t=0;t<3;t++){if(isNaN(Number(s[t]))||isNaN(Number(e[t])))return!1;if(Number(s[t])>Number(e[t]))return!0;if(Number(s[t])<Number(e[t]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return Object.assign(Object.assign({},this.session.getInfo()),this.getTrackerInfo())}getSessionToken(){return this.session.getSessionToken()}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(t){var e,{projectID:s,sessionID:n,timestamp:i}=this.session.getInfo();if(s&&n)return e=this.options.ingestPoint,e=(/api\.openreplay\.com/.test(e)?"https://openreplay.com/ingest":e).replace(/ingest$/,s+"/session/"+n),null!=t&&t.withCurrentTime?e+"?jumpto="+(b()-i):e;this.debug.error("OpenReplay error: Unable to build session URL")}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){var t;return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI||(null==(t=null==(t=document.head)?void 0:t.getElementsByTagName("base")[0])?void 0:t.getAttribute("href"))||location.origin+location.pathname)}resolveResourceURL(t){var e=new URL(this.getBaseHref());return e.pathname+="/"+new URL(t).pathname,e.pathname.replace(/\/+/g,"/"),e.toString()}isServiceURL(t){return t.startsWith(this.options.ingestPoint)}active(){return this.activityState===w.Active}resetNextPageSession(t){t?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}_start(t={},e=!1){if(!this.worker)return Promise.resolve(ae("No worker found: perhaps, CSP is not set."));if(this.activityState!==w.NotActive)return Promise.resolve(ae("OpenReplay: trying to call `start()` on the instance that has been started already."));this.activityState=w.Starting,M=Date.now()-performance.now(),t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata});const m=b();this.worker.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:m,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});var s=null!==this.sessionStorage.getItem(this.options.session_reset_key),t=(this.sessionStorage.removeItem(this.options.session_reset_key),t.forceNew||s||e);const v=this.session.getSessionToken(),y=t||!v;return console.log("OpenReplay: starting session",t,v),window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign(Object.assign({},this.getTrackerInfo()),{timestamp:m,userID:this.session.getInfo().userID,token:y?void 0:v,deviceMemory:se,jsHeapSizeLimit:ne}))}).then(e=>200===e.status?e.json():e.text().then(t=>t===oe?Promise.reject(oe):Promise.reject(`Server error: ${e.status}. `+t))).then(t=>{if(!this.worker)return Promise.reject("no worker found after start request (this might not happen)");if(this.activityState===w.NotActive)return Promise.reject("Tracker stopped during authorization");var{token:e,userUUID:s,projectID:n,beaconSizeLimit:i,compressionThreshold:r,delay:o,sessionID:a,startTimestamp:c,userBrowser:h,userCity:u,userCountry:l,userDevice:d,userOS:p,userState:f}=t;if("string"!=typeof e||"string"!=typeof s||"number"!=typeof c&&void 0!==c||"string"!=typeof a||"number"!=typeof o||"number"!=typeof i&&void 0!==i)return Promise.reject("Incorrect server response: "+JSON.stringify(t));this.delay=o,this.session.setSessionToken(e),this.session.setUserInfo({userBrowser:h,userCity:u,userCountry:l,userDevice:d,userOS:p,userState:f}),this.session.assign({sessionID:a,timestamp:c||m,projectID:n}),y||e!==v||(console.log("continuing session on new tab",this.session.getTabId()),this.send(it(this.session.getTabId()))),Object.entries(this.session.getInfo().metadata).forEach(([t,e])=>this.send(k(t,e))),this.localStorage.setItem(this.options.local_uuid_key,s),this.worker.postMessage({type:"auth",token:e,beaconSizeLimit:i}),this.compressionThreshold=r;const g={sessionToken:e,userUUID:s,sessionID:a};return this.startCallbacks.forEach(t=>t(g)),this.observer.observe(),this.ticker.start(),this.activityState=w.Active,this.notify.log("OpenReplay tracking started."),"function"==typeof this.options.onStart&&this.options.onStart(g),this.restartAttempts=0,t=g,Object.assign(Object.assign({},t),{success:!0})}).catch(t=>(this.stop(),this.session.reset(),t===oe?ae(oe):(this.notify.log("OpenReplay was unable to start. ",t),this._debug("session_start",t),ae(":("))))}start(...s){return document.hidden?new Promise(t=>{const e=()=>{document.hidden||(document.removeEventListener("visibilitychange",e),setTimeout(()=>{t(this._start(...s))},10))};document.addEventListener("visibilitychange",e)}):new Promise(t=>{setTimeout(()=>{t(this._start(...s))},10)})}forceFlushBatch(){var t;null!=(t=this.worker)&&t.postMessage("forceFlushBatch")}getTabId(){return this.session.getTabId()}stop(t=!0){if(this.activityState!==w.NotActive)try{this.attributeSender.clear(),this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach(t=>t()),this.notify.log("OpenReplay tracking stopped."),this.worker&&t&&this.worker.postMessage("stop")}finally{this.activityState=w.NotActive}}}const ue=L&&"InstallTrigger"in window?t=>t.message+"\n"+t.stack:t=>t.stack||t.message;function le(t){return void 0===t?"undefined":null===t?"null":t instanceof Error?ue(t):Array.isArray(t)?`Array(${t.length})`:String(t)}function de(e){if(void 0===e)return"undefined";if(null===e)return"null";if(e instanceof Error)return ue(e);if(Array.isArray(e))return`Array(${e.length})[${e.slice(0,10).map(le).join(", ")}]`;if("object"!=typeof e)return e.toString();{var s=[];let t=0;for(const i in e){if(10==++t)break;var n=e[i];s.push(i+": "+le(n))}return"{"+s.join(", ")+"}"}}function pe(i){return"string"==typeof i[0]&&i.unshift(i.shift().replace(/%(o|s|f|d|i)/g,(t,e)=>{var s,n=i.shift();if(void 0===n)return t;switch(e){case"o":return de(n);case"s":return le(n);case"f":return"number"!=typeof(s=n)?"NaN":s.toString();case"d":case"i":return"number"!=typeof(s=n)?"NaN":Math.floor(s).toString();default:return t}})),i.map(de).join(" ")}const fe=["log","info","warn","error","debug","assert"];function ge(o,t){const a=Object.assign({consoleMethods:fe,consoleThrottling:30},t);if(Array.isArray(a.consoleMethods)&&0!==a.consoleMethods.length){const c=o.safe((t,e)=>o.send([22,t,pe(e)]));let r=0;t=()=>{r=0};o.attachStartCallback(t),o.ticker.attach(t,33,!1);t=o.safe(t=>{{var s=t.console,n=t;const i={apply:function(t,e,s){Reflect.apply(t,n,s),(r+=1)>a.consoleThrottling||c(t.name,s)}};a.consoleMethods.forEach(t=>{var e;-1===fe.indexOf(t)?o.debug.error(`OpenReplay: unsupported console method "${t}"`):(e=n.console[t],s[t]=new Proxy(e,i))})}});t(window),o.observer.attachContextCallback(t)}}function me(t,e){return t(e={exports:{}},e.exports),e.exports}var a,ve=me(function(t,e){t.exports=function(){function s(t){return!isNaN(parseFloat(t))&&isFinite(t)}function n(t){return t.charAt(0).toUpperCase()+t.substring(1)}function t(t){return function(){return this[t]}}var e=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],r=["fileName","functionName","source"],o,a,c=e.concat(i,r,["args"],["evalOrigin"]);function l(t){if(!t)return;for(var e=0;e<c.length;e++)if(t[c[e]]!==undefined)this["set"+n(c[e])](t[c[e]])}l.prototype={getArgs:function(){return this.args},setArgs:function(t){if(Object.prototype.toString.call(t)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof l)this.evalOrigin=t;else if(t instanceof Object)this.evalOrigin=new l(t);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var t=this.getFileName()||"";var e=this.getLineNumber()||"";var s=this.getColumnNumber()||"";var n=this.getFunctionName()||"";if(this.getIsEval()){if(t)return"[eval] ("+t+":"+e+":"+s+")";return"[eval]:"+e+":"+s}if(n)return n+" ("+t+":"+e+":"+s+")";return t+":"+e+":"+s}},l.fromString=function t(e){var s=e.indexOf("(");var n=e.lastIndexOf(")");var i=e.substring(0,s);var r=e.substring(s+1,n).split(",");var o=e.substring(n+1);if(o.indexOf("@")===0){var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,"");var c=a[1];var h=a[2];var u=a[3]}return new l({functionName:i,args:r||undefined,fileName:c,lineNumber:h||undefined,columnNumber:u||undefined})};for(var h=0;h<e.length;h++){l.prototype["get"+n(e[h])]=t(e[h]);l.prototype["set"+n(e[h])]=function(e){return function(t){this[e]=Boolean(t)}}(e[h])}for(var u=0;u<i.length;u++){l.prototype["get"+n(i[u])]=t(i[u]);l.prototype["set"+n(i[u])]=function(e){return function(t){if(!s(t))throw new TypeError(e+" must be a Number");this[e]=Number(t)}}(i[u])}for(var d=0;d<r.length;d++){l.prototype["get"+n(r[d])]=t(r[d]);l.prototype["set"+n(r[d])]=function(e){return function(t){this[e]=String(t)}}(r[d])}return l}()}),ye=me(function(t,e){t.exports=function(c){var n=/(^|@)\S+:\d+/;var i=/^\s*at .*(\S+:\d+|\(native\))/m;var r=/^(eval@)?(\[native code])?$/;return{parse:function t(e){if(typeof e.stacktrace!=="undefined"||typeof e["opera#sourceloc"]!=="undefined")return this.parseOpera(e);else if(e.stack&&e.stack.match(i))return this.parseV8OrIE(e);else if(e.stack)return this.parseFFOrSafari(e);else throw new Error("Cannot parse given Error object")},extractLocation:function t(e){if(e.indexOf(":")===-1)return[e];var s=/(.+?)(?::(\d+))?(?::(\d+))?$/;var n=s.exec(e.replace(/[()]/g,""));return[n[1],n[2]||undefined,n[3]||undefined]},parseV8OrIE:function t(e){var s=e.stack.split("\n").filter(function(t){return!!t.match(i)},this);return s.map(function(t){if(t.indexOf("(eval ")>-1)t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,"");var e=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"");var s=e.match(/ (\(.+\)$)/);e=s?e.replace(s[0],""):e;var n=this.extractLocation(s?s[1]:e);var i=s&&e||undefined;var r=["eval","<anonymous>"].indexOf(n[0])>-1?undefined:n[0];return new c({functionName:i,fileName:r,lineNumber:n[1],columnNumber:n[2],source:t})},this)},parseFFOrSafari:function t(e){var s=e.stack.split("\n").filter(function(t){return!t.match(r)},this);return s.map(function(t){if(t.indexOf(" > eval")>-1)t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1");if(t.indexOf("@")===-1&&t.indexOf(":")===-1)return new c({functionName:t});else{var e=/((.*".+"[^@]*)?[^@]*)(?:@)/;var s=t.match(e);var n=s&&s[1]?s[1]:undefined;var i=this.extractLocation(t.replace(e,""));return new c({functionName:n,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})}},this)},parseOpera:function t(e){if(!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length)return this.parseOpera9(e);else if(!e.stack)return this.parseOpera10(e);else return this.parseOpera11(e)},parseOpera9:function t(e){var s=/Line (\d+).*script (?:in )?(\S+)/i;var n=e.message.split("\n");var i=[];for(var r=2,o=n.length;r<o;r+=2){var a=s.exec(n[r]);if(a)i.push(new c({fileName:a[2],lineNumber:a[1],source:n[r]}))}return i},parseOpera10:function t(e){var s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var n=e.stacktrace.split("\n");var i=[];for(var r=0,o=n.length;r<o;r+=2){var a=s.exec(n[r]);if(a)i.push(new c({functionName:a[3]||undefined,fileName:a[2],lineNumber:a[1],source:n[r]}))}return i},parseOpera11:function t(e){var s=e.stack.split("\n").filter(function(t){return!!t.match(n)&&!t.match(/^Error created at/)},this);return s.map(function(t){var e=t.split("@");var s=this.extractLocation(e.pop());var n=e.shift()||"";var i=n.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||undefined;var r;if(n.match(/\(([^)]*)\)/))r=n.replace(/^[^(]+\(([^)]*)\)$/,"$1");var o=r===undefined||r==="[arguments not available]"?undefined:r.split(",");return new c({functionName:i,args:o,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:t})},this)}}}(ve)});function be(t){return[{columnNumber:t.colno,lineNumber:t.lineno,fileName:t.filename,functionName:"",source:""}]}function Se(t,e,s={}){let n=e;try{n=ye.parse(t)}catch(t){}return y(t.name,t.message,JSON.stringify(n),JSON.stringify(s))}function we(s,t=window,n={}){if(s instanceof ErrorEvent){if(s.error instanceof Error)return Se(s.error,be(s),n);{let[t,e]=s.message.split(":");return e||(t="Error",e=s.message),y(t,e,JSON.stringify(be(s)),JSON.stringify(n))}}if("PromiseRejectionEvent"in t&&s instanceof t.PromiseRejectionEvent){if(s.reason instanceof Error)return Se(s.reason,[],n);{let e;try{e=JSON.stringify(s.reason)}catch(t){e=String(s.reason)}return y("Unhandled Promise Rejection",e,"[]",JSON.stringify(n))}}return null}function ke(t,e=document.location){return(t=t.trim()).startsWith("//")||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?e.origin+t:e.origin+e.pathname+t}function Ne(i){function n(t,e){i.attributeSender.sendSetAttribute(t,"src","https://static.openreplay.com/tracker/placeholder.jpeg");var{width:s,height:n}=e.getBoundingClientRect();e.hasAttribute("width")||i.attributeSender.sendSetAttribute(t,"width",String(s)),e.hasAttribute("height")||i.attributeSender.sendSetAttribute(t,"height",String(n))}function r(t,e){(e=e["srcset"])&&(e=e.split(",").map(t=>ke(t)).join(","),i.attributeSender.sendSetAttribute(t,"srcset",e))}function o(t,e){1e5<e.src.length&&n(t,e),i.send(m(t,"src",e.src,i.getBaseHref()))}const a=i.safe(function(t){t=ke(t.src||"");_(t)&&i.send(N(i.timestamp(),0,0,0,0,0,t,"img",0,!1))}),e=i.safe(function(t){var e,s=i.nodes.getID(t);void 0!==s&&t.complete&&(0!==t.naturalHeight||0!==t.naturalWidth||(e=t.src,E&&(e.startsWith("data:image/svg+xml")||e.match(/.svg$|/i)))?(i.sanitizer.isHidden(s)||i.sanitizer.isObscured(s)?n:(o(s,t),r))(s,t):a(t))}),s=new MutationObserver(t=>{for(const n of t)if("attributes"===n.type){var e=n.target,s=i.nodes.getID(e);if(void 0===s)return;"src"===n.attributeName&&o(s,e),"srcset"===n.attributeName&&r(s,e)}});i.attachStopCallback(()=>{s.disconnect()}),i.nodes.attachNodeCallback(t=>{P(t,"img")&&(i.nodes.attachNodeListener(t,"error",()=>a(t)),i.nodes.attachNodeListener(t,"load",()=>e(t)),e(t),s.observe(t,{attributes:!0,attributeFilter:["src","srcset"]}))})}const Te=["text","password","email","search","number","range","date","tel","time"];const Ee=L&&"labels"in HTMLInputElement.prototype?t=>{let e=t;for(;null!==(e=e.parentNode);)if(P(e,"label"))return e;t=t.labels;if(null!==t&&1===t.length)return t[0]}:t=>{let e=t;for(;null!==(e=e.parentNode);)if(P(e,"label"))return e;var s=t.id;if(s){t=t.ownerDocument.querySelectorAll('label[for="'+s+'"]');if(null!==t&&1===t.length)return t[0]}};function Oe(t){let e=D(t);var s;return null===e&&(s=Ee(t),e=s&&s.innerText||t.placeholder||t.name||t.id||t.className||t.type),I(e).slice(0,100)}const c={Plain:0,Obscured:1,Hidden:2};function Ie(l,t){const r=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:c.Obscured,obscureInputDates:!1},t);function d(t,e){let s=e.value,n=r.defaultInputMode,i=("password"===e.type||l.sanitizer.isHidden(t)?n=c.Hidden:(l.sanitizer.isObscured(t)||n===c.Plain&&(r.obscureInputNumbers&&"date"!==e.type&&/\d\d\d\d/.test(s)||r.obscureInputDates&&"date"===e.type||r.obscureInputEmails&&("email"===e.type||~s.indexOf("@"))))&&(n=c.Obscured),0);switch(n){case c.Hidden:i=-1,s="";break;case c.Obscured:i=s.length,s=""}return{value:s,mask:i}}function s(t,e){var{value:e,mask:s}=d(t,e);l.send([18,t,e,s])}const n=new Map,i=new Map;function p(t,e){n.get(t)!==e.value&&(n.set(t,e.value),s(t,e))}function o(t,e){i.get(t)!==e&&(i.set(t,e),l.send([19,t,e]))}l.attachStopCallback(()=>{n.clear(),i.clear()}),l.ticker.attach(()=>{n.forEach((t,e)=>{var s=l.nodes.getNode(e);if(!s)return n.delete(e);p(e,s)}),i.forEach((t,e)=>{var s=l.nodes.getNode(e);if(!s)return i.delete(e);o(e,s.checked)})},3),l.nodes.attachNodeCallback(l.safe(h=>{const u=l.nodes.getID(h);if(void 0!==u)if(P(h,"select")&&(s(u,h),l.nodes.attachNodeListener(h,"change",()=>s(u,h))),P(t=h,"textarea")||P(t,"input")&&Te.includes(t.type)){p(u,h);let o=0,a=0,c=0;l.nodes.attachNodeListener(h,"focus",()=>{o=b()}),l.nodes.attachNodeListener(h,"input",()=>{0===a&&0!==o&&(a=b()-o)}),void l.nodes.attachNodeListener(h,"change",()=>{0!==o&&(c=b()-o);var t=u,e=h,s=a,n=c,{value:i,mask:r}=d(t,e),e=Oe(e);l.send([112,t,i,0!==r,e,s,n]),a=0,c=0,o=0})}else{var t;!function(t){if(P(t,"input"))return"checkbox"===(t=t.type)||"radio"===t}(h)||(o(u,h.checked),l.nodes.attachNodeListener(h,"change",()=>o(u,h.checked)))}}))}let u,_e;function Re(t,e){if(t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===t.tagName.toLowerCase())return"html";var s={root:document.body,idName:t=>!0,className:t=>!0,tagName:t=>!0,attr:(t,e)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};u={...s,...e},_e=(e=u.root,s=s,e.nodeType===Node.DOCUMENT_NODE||e!==s.root?e:e.ownerDocument);let n=De(t,"all",()=>De(t,"two",()=>De(t,"one",()=>De(t,"none"))));if(n)return s=Fe(function*e(s,n,i={counter:0,visited:new Map}){if(2<s.length&&s.length>u.optimizedMinLength)for(let t=1;t<s.length-1;t++){if(i.counter>u.maxNumberOfTries)return;i.counter+=1;const r=[...s],o=(r.splice(t,1),xe(r));if(i.visited.has(o))return;Me(r)&&ze(r,n)&&(yield r,i.visited.set(o,!0),yield*e(r,n,i))}}(n,t)),xe(n=0<s.length?s[0]:n);throw new Error("Selector was not found.")}function De(t,e,s){let n=null;var i,r,o=[];let a=t,c=0;for(;a;){let t=Pe(function(t){t=t.getAttribute("id");if(t&&u.idName(t))return{name:"#"+CSS.escape(t),penalty:0};return null}(a))||Pe(...function(t){t=Array.from(t.attributes).filter(t=>u.attr(t.name,t.value));return t.map(t=>({name:`[${CSS.escape(t.name)}="${CSS.escape(t.value)}"]`,penalty:.5}))}(a))||Pe(...function(t){t=Array.from(t.classList).filter(u.className);return t.map(t=>({name:"."+CSS.escape(t),penalty:1}))}(a))||Pe(function(t){t=t.tagName.toLowerCase();if(u.tagName(t))return{name:t,penalty:2};return null}(a))||[Ae()];const h=function(t){var e=t.parentNode;if(!e)return null;let s=e.firstChild;if(!s)return null;let n=0;for(;s&&(s.nodeType===Node.ELEMENT_NODE&&n++,s!==t);)s=s.nextSibling;return n}(a);"all"==e?h&&(t=t.concat(t.filter(He).map(t=>je(t,h)))):"two"==e?(t=t.slice(0,1),h&&(t=t.concat(t.filter(He).map(t=>je(t,h))))):"one"==e?([i]=t=t.slice(0,1),h&&He(i)&&(t=[je(i,h)])):"none"==e&&(t=[Ae()],h)&&(t=[je(t[0],h)]);for(r of t)r.level=c;if(o.push(t),o.length>=u.seedMinLength&&(n=Ce(o,s)))break;a=a.parentElement,c++}return!(n=n||Ce(o,s))&&s?s():n}function Ce(t,e){var s,t=Fe(function*t(e,s=[]){if(0<e.length)for(var n of e[0])yield*t(e.slice(1,e.length),s.concat(n));else yield s}(t));if(t.length>u.threshold)return e?e():null;for(s of t)if(Me(s))return s;return null}function xe(e){let s=e[0],n=s.name;for(let t=1;t<e.length;t++){var i=e[t].level||0;n=s.level===i-1?e[t].name+" > "+n:e[t].name+" "+n,s=e[t]}return n}function Le(t){return t.map(t=>t.penalty).reduce((t,e)=>t+e,0)}function Me(t){var e=xe(t);switch(_e.querySelectorAll(e).length){case 0:throw new Error("Can't select any node with this selector: "+e);case 1:return!0;default:return!1}}function Ae(){return{name:"*",penalty:3}}function je(t,e){return{name:t.name+`:nth-child(${e})`,penalty:t.penalty+1}}function He(t){return"html"!==t.name&&!t.name.startsWith("#")}function Pe(...t){t=t.filter(Ue);return 0<t.length?t:null}function Ue(t){return null!=t}function Fe(t){return[...t].sort((t,e)=>Le(t)-Le(e))}function ze(t,e){return _e.querySelector(xe(t))===e}function qe(t){var e=t.tagName.toUpperCase();return"BUTTON"===e||"A"===e||"LI"===e||"SELECT"===e||"TR"===e||"TH"===e||null!=t.onclick||"button"===t.getAttribute("role")}function Be(e,s){if(e instanceof Element){var n=e;var i=s;let t=n;for(;null!==t&&t!==i.documentElement;){if(o(t,"masked"))return null;t=t.parentElement}if(ot(n)){let t=n.ownerSVGElement;for(;null!==t;)t=(n=t).ownerSVGElement}t=n;for(;null!==t&&t!==i.documentElement;){var r=t.tagName.toUpperCase();if("LABEL"===r)return null;if("INPUT"===r)return t;if(qe(t)||null!==D(t))return t;t=t.parentElement}return n===i.documentElement?null:n}return null}function We(i,r){const{disableClickmaps:o=!1}=r||{};let a=-1,c=-1,h=!1,u=null,l=0,d={},s=0,p=0,f=0,g=0,t;i.attachStartCallback(()=>{t=setInterval(()=>{var t,e;e=g/225,s=(s&&(t=(e-s)/225,4<f&&.008<t&&i.send([114,b()]),g=0,f=0),e)},225)}),i.attachStopCallback(()=>{a=-1,c=-1,h=!1,u=null,d={},t&&clearInterval(t)});const m=()=>{h&&(i.send([20,a,c]),h=!1)},e=(n,t=!1)=>{function s(t,e,s){return d[t]=d[t]||(t=s,Re(e,{root:n.body,seedMinLength:3,optimizedMinLength:(null==t?void 0:t.minSelectorDepth)||2,threshold:(null==t?void 0:t.nthThreshold)||1e3,maxNumberOfTries:(null==t?void 0:t.maxOptimiseTries)||1e4}))}t=t?i.attachEventListener.bind(i):i.nodes.attachNodeListener.bind(i.nodes);t(n.documentElement,"mouseover",t=>{t=Be(t.target,n);t!==u&&(u=t,l=performance.now())}),t(n,"mousemove",t=>{var[e,s]=i.observer.getDocumentOffset(n),e=(a=t.clientX+e,c=t.clientY+s,h=!0,Math.sign(t.movementX));g+=Math.abs(t.movementX)+Math.abs(t.movementY),e!==p&&(p=e,f++)},!1),t(n,"click",t=>{var e=Be(t.target,n);(t.clientX||t.clientY)&&null!==e&&(void 0!==(t=i.nodes.getID(e))&&(m(),i.send([69,t,u===e?Math.round(performance.now()-l):0,function(e){var t=D(e);if(null!==t)return t;if(P(e,"input"))return Oe(e);if(qe(e)){let t="";return I(t=(t=e instanceof HTMLElement?i.sanitizer.getInnerTextSecure(e):t)||e.id||e.className).slice(0,100)}return""}(e),qe(e)&&!o?s(t,e,r):""],!0)),u=null)})};i.nodes.attachNodeCallback(t=>{H(t)&&e(t)}),e(document,!0),i.ticker.attach(m,(null==r?void 0:r.trackingOffset)||7)}function Xe(l,t){t=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0},t);if("PerformanceObserver"in window||(t.captureResourceTimings=!1),t.captureResourceTimings){let c={};const n=new PerformanceObserver(t=>t.getEntries().forEach(s));let e,h=(l.attachStartCallback(function({sessionID:t}){t!==e&&(performance.getEntriesByType("resource").forEach(s),e=t),n.observe({entryTypes:["resource"]})}),l.attachStopCallback(function(){n.disconnect()}),0),u=0;if(t.capturePageLoadTimings){let c=!1;l.ticker.attach(()=>{var t,e,s,n,i,r,o,a;!c&&(0!==h&&0!==u||performance.getEntriesByType("paint").forEach(t=>{var{name:t,startTime:e}=t;switch(t){case"first-paint":h=e;break;case"first-contentful-paint":u=e}}),performance.timing.loadEventEnd||3e4<performance.now())&&(c=!0,{navigationStart:t,requestStart:e,responseStart:s,responseEnd:n,domContentLoadedEventStart:i,domContentLoadedEventEnd:r,loadEventStart:o,loadEventEnd:a}=performance.timing,l.send([23,e-t||0,s-t||0,n-t||0,i-t||0,r-t||0,o-t||0,a-t||0,h,u]))},30)}if(t.capturePageRenderTimings){let n=0,i=0,r=0,o=null,a=!1;l.ticker.attach(()=>{var t,e,s;!a&&(t=performance.now(),null!==c&&1e3<t-(n=Math.max.apply(null,Object.keys(c).map(t=>c[t])))&&(o=function(s){var n=[],i=document.getElementsByTagName("*"),r=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let e=0;e<i.length;e++){var o,a,c,h,u=i[e];let t="";(t=P(u,"img")?u.currentSrc||u.src:t)||(o=getComputedStyle(u).getPropertyValue("background-image"))&&null!==(o=r.exec(o))&&((t=o[1]).startsWith('"')||t.startsWith("'"))&&(t=t.substr(1,t.length-2)),t&&(void 0===(o="data:image"===t.substr(0,10)?0:s[t])||(u=u.getBoundingClientRect(),a=Math.max(u.top,0),c=Math.max(u.left,0),h=Math.min(u.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),u=Math.min(u.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0),h<=a)||u<=c||n.push({time:o,area:(h-a)*(u-c)}))}return n}(c),c=null),null!==r&&(50<t-r&&(i=t),r=5e3<t-i?null:t),null!==o&&null===r||3e4<t)&&(a=!0,t=(c=null)===o?0:function(e,s){let n=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,i=n*e;for(let t=0;t<s.length;t++){var{time:r,area:o}=s[t];n+=o,i+=o*(e<r?r:e)}return 0===n?0:i/n}(u||h,o),{domContentLoadedEventEnd:s,navigationStart:e}=performance.timing,s=null===r?Math.max(i,u,s-e||0):0,l.send([24,t,u>n?u:n,s]))})}function s(t){t.duration<0||!_(t.name)||l.isServiceURL(t.name)||(null!==c&&(c[t.name]=t.startTime+t.duration),l.send(N(t.startTime+M,t.duration,t.responseStart&&t.startTime?t.responseStart-t.startTime:0,t.transferSize>t.encodedBodySize?t.transferSize-t.encodedBodySize:0,t.encodedBodySize||0,t.decodedBodySize||0,t.name,t.initiatorType,t.transferSize,t.responseStatus&&304===t.responseStatus||0===t.transferSize)))}}}function $e(t){var e=t.defaultView;return[e&&e.pageXOffset||t.documentElement&&t.documentElement.scrollLeft||t.body&&t.body.scrollLeft||0,e&&e.pageYOffset||t.documentElement&&t.documentElement.scrollTop||t.body&&t.body.scrollTop||0]}function Je(s){let e=!1;const n=new Map;function i(t){rt(t)&&(d(t)&&n.set(t,[t.scrollLeft,t.scrollTop]),H(t))&&n.set(t,$e(t))}const t=s.safe(()=>{return s.send(([t,e]=[...$e(document)],[6,t,e]));var t,e}),r=s.safe((t,e)=>{e=s.nodes.getID(e);void 0!==e&&s.send([16,e,t[0],t[1]])});s.attachStartCallback(t),s.attachStopCallback(()=>{e=!1,n.clear()}),s.nodes.attachNodeCallback((t,e)=>{e&&(d(t)&&0<t.scrollLeft+t.scrollTop?n.set(t,[t.scrollLeft,t.scrollTop]):H(t)&&n.set(t,$e(t))),p(t)&&s.nodes.attachNodeListener(t,"scroll",t=>{i(t.target)})}),s.attachEventListener(document,"scroll",t=>{t=t.target;t===document?e=!0:i(t)}),s.ticker.attach(()=>{e&&(t(),e=!1),n.forEach(r),n.clear()},5,!1)}function Ke(t){return p(t)&&t.adoptedStyleSheets}let Ve=15;const Ge=new Map;function Ye(m,s,v,y,b){function n(t){m.debug.log("Openreplay: capturing axios response data",t);var{headers:e,data:s,method:n,url:i}=t.config,{data:r,headers:o,status:a,response:c}=t,{data:c,headers:h,status:u}=c||{};const l=v.ignoreHeaders,d=Array.isArray(l)?t=>l.includes(t):()=>l;function p(t,e){d(e[0])||(t[e[0]]=e[1])}let f={},g={};e.toJSON?f=e.toJSON():e instanceof Headers?e.forEach((t,e)=>p(f,[e,t])):Array.isArray(e)?e.forEach(t=>p(f,t)):"object"==typeof e&&Object.entries(e).forEach(t=>p(f,t));var e=h||o,h=(e.toJSON?g=e.toJSON():e instanceof Headers?e.forEach((t,e)=>p(g,[e,t])):Array.isArray(e)?e.forEach(t=>p(g,t)):"object"==typeof e&&Object.entries(e).forEach(([t,e])=>{d(t)||(g[t]=e)}),y({url:i,method:n||"",status:a||u||0,request:{headers:f,body:s},response:{headers:g,body:c||r}}));h?(o=t.config.__openreplay_timing,e=performance.now()-o,m.debug.log("Openreplay: final req object",h),m.send(S("xhr",String(n),String(h.url),b(h.request),b(h.response),h.status,o+M,e))):m.debug.log("Openreplay: empty request/response info, skipping")}m.debug.log("Openreplay: attaching axios spy to instance",s);const i=s.interceptors.request.use(function(t){var e,s;return m.debug.log("Openreplay: capturing API request",t),t.__openreplay_timing=performance.now(),v.sessionTokenHeader&&(e="string"==typeof v.sessionTokenHeader?v.sessionTokenHeader:"X-OpenReplay-Session-Token",s=m.getSessionToken())&&t.headers.set(e,s),t},function(t){m.debug.log("Openreplay: failed API request, skipping",t)},{synchronous:!0}),r=s.interceptors.response.use(function(t){return v.failuresOnly||n(t),t},function(t){var e;return m.debug.log("Openreplay: capturing API request error",t),function(t){return null!==t&&"object"==typeof t}(e=t)&&!0===e.isAxiosError&&Boolean(t.response)?n(t.response):t instanceof Error&&m.send(Se(t,[])),Promise.reject(t)},{synchronous:!0});m.attachStopCallback(()=>{var t,e;null!=(t=(e=s.interceptors.request).eject)&&t.call(e,i),null!=(e=(t=s.interceptors.response).eject)&&e.call(t,r)})}(t=a=a||{})[t.UNSENT=0]="UNSENT",t[t.OPENED=1]="OPENED",t[t.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",t[t.LOADING=3]="LOADING",t[t.DONE=4]="DONE";class Qe{constructor(t=[],e,s){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header={},this.responseType="",this.requestHeader={},this.responseSize=0,this.responseSizeText="",this.startTime=0,this.endTime=0,this.duration=0,this.getData={},this.requestData=null}getMessage(){var{reqHs:t,resHs:e}=this.writeHeaders(),t={headers:t,body:"GET"===this.method?JSON.stringify(this.getData):this.requestData},e={headers:e,body:this.response},t=this.sanitize({url:this.url,method:this.method,status:this.status,request:t,response:e});return S(this.requestType,t.method,t.url,JSON.stringify(t.request),JSON.stringify(t.response),t.status,this.startTime+M,this.duration)}writeHeaders(){const s={},n=(Object.entries(this.requestHeader).forEach(([t,e])=>{this.isHeaderIgnored(t)||(s[t]=e)}),this.setSessionTokenHeader((t,e)=>{s[t]=e}),{});return Object.entries(this.header).forEach(([t,e])=>{this.isHeaderIgnored(t)||(n[t]=e)}),{reqHs:s,resHs:n}}isHeaderIgnored(t){return Array.isArray(this.ignoredHeaders)?this.ignoredHeaders.includes(t):this.ignoredHeaders}}const h=(t,e)=>{let s="";switch(t){case"":case"text":case"json":"string"==typeof e?s=e:ts(e)||Array.isArray(e)?s=JSON.stringify(e):void 0!==e&&(s=Object.prototype.toString.call(e));break;default:void 0!==e&&(s=Object.prototype.toString.call(e))}return s},Ze=t=>{if(!t)return null;let e;if("string"==typeof t){"{"!==t[0]&&"["!==t[0]||(e=t);var s=t.split("&");e=1===s.length?t:s.join(",")}else if(null!=(s=t)&&"undefined"!=typeof Symbol&&"function"==typeof s[Symbol.iterator]){var n,i,r=[];for([n,i]of t)r.push(n+"="+("string"==typeof i?i:"[object Object]"));e=r.join(",")}else e=t instanceof Blob||t instanceof ReadableStream||t instanceof ArrayBuffer?"byte data":ts(t)?t:"can't parse body "+typeof t;return e};function ts(t){return null!==t&&"object"==typeof t}function es(t){return t<=0?"":1e6<=t?(t/1e3/1e3).toFixed(1)+" MB":1e3<=t?(t/1e3).toFixed(1)+" KB":t+"B"}const ss=t=>{return(t=t.startsWith("//")?""+new URL(window.location.href).protocol+t:t).startsWith("http")?new URL(t):new URL(t,window.location.href)};class ns{constructor(t,e){this.resp=t,this.item=e,this.mockReader()}set(t,e,s){return Reflect.set(t,e,s)}get(t,e){const s=Reflect.get(t,e);switch(e){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return()=>(this.item.responseType=e.toLowerCase(),s.apply(t).then(t=>(this.item.response=h(this.item.responseType,t),t)))}return"function"==typeof s?s.bind(t):s}mockReader(){let n;if(this.resp.body&&"function"==typeof this.resp.body.getReader){const i=this.resp.body.getReader;this.resp.body.getReader=()=>{const e=i.apply(this.resp.body);if(this.item.readyState!==a.DONE){const t=e.read,s=e.cancel;this.item.responseType="arraybuffer",e.read=()=>t.apply(e).then(t=>{var e;return n=n?((e=new Uint8Array(n.length+t.value.length)).set(n),e.set(t.value,n.length),e):new Uint8Array(t.value),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.readyState=t.done?4:3,this.item.statusText=t.done?String(this.item.status):"Loading",this.item.responseSize=n.length,this.item.responseSizeText=es(this.item.responseSize),t.done&&(this.item.response=h(this.item.responseType,n)),t}),e.cancel=(...t)=>(this.item.cancelState=2,this.item.statusText="Cancel",this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=h(this.item.responseType,n),s.apply(e,t))}return e}}}}class is{constructor(t,e,s,n,i){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.sendMessage=n,this.isServiceUrl=i}apply(t,e,s){var n=s[0],i=s[1];if(n instanceof URL||"string"==typeof n?this.isServiceUrl(String(n)):this.isServiceUrl(String(n.url)))return t.apply(window,s);const r=new Qe(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);return this.beforeFetch(r,n,i),t.apply(window,s).then(this.afterFetch(r)).catch(t=>{throw r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),t})}beforeFetch(t,e,s){let n,i="GET",r={};if(r="string"==typeof e?(i=(null==s?void 0:s.method)||"GET",n=ss(e),(null==s?void 0:s.headers)||{}):(i=e.method||"GET",n=ss(e.url),e.headers),t.method=i,t.requestType="fetch",t.requestHeader=r,t.url=n.toString(),t.name=(n.pathname.split("/").pop()||"")+n.search,t.status=0,t.statusText="Pending",t.readyState=1,t.startTime||(t.startTime=performance.now()),"[object Headers]"===Object.prototype.toString.call(r)){t.requestHeader={};for(var[o,a]of r)t.requestHeader[o]=a}else t.requestHeader=r;if(n.search&&n.searchParams){t.getData={};for(var[c,h]of n.searchParams)t.getData[c]=h}null!=s&&s.body&&(t.requestData=Ze(s.body))}afterFetch(i){return t=>{i.endTime=performance.now(),i.duration=i.endTime-(i.startTime||i.endTime),i.status=t.status,i.statusText=String(t.status);let e=!1;i.header={};for(var[s,n]of t.headers)i.header[s]=n,e=-1<n.toLowerCase().indexOf("chunked")||e;return e?i.readyState=3:(i.readyState=4,this.handleResponseBody(t.clone(),i).then(t=>{i.responseSize="string"==typeof t?t.length:t.byteLength,i.responseSizeText=es(i.responseSize),i.response=h(i.responseType,t),this.sendMessage(i.getMessage())})),new Proxy(t,new ns(t,i))}}handleResponseBody(t,e){var s=t.headers.get("content-type");return s&&s.includes("application/json")?(e.responseType="json",t.text()):s&&(s.includes("text/html")||s.includes("text/plain"))?(e.responseType="text",t.text()):(e.responseType="arraybuffer",t.arrayBuffer())}}class rs{static create(t,e,s,n,i){return new Proxy(fetch,new is(t,e,s,n,i))}}rs.origFetch=fetch;class os{constructor(t,e,s,n,i,r){this.ignoredHeaders=e,this.setSessionTokenHeader=s,this.sanitize=n,this.sendMessage=i,this.isServiceUrl=r,this.XMLReq=t,this.XMLReq.onreadystatechange=()=>{this.onReadyStateChange()},this.XMLReq.onabort=()=>{this.onAbort()},this.XMLReq.ontimeout=()=>{this.onTimeout()},this.item=new Qe(e,s,n),this.item.requestType="xhr"}get(t,e){switch(e){case"open":return this.getOpen(t);case"send":return this.getSend(t);case"setRequestHeader":return this.getSetRequestHeader(t);default:var s=Reflect.get(t,e);return"function"==typeof s?s.bind(t):s}}set(t,e,s){switch(e){case"onreadystatechange":return this.setOnReadyStateChange(t,e,s);case"onabort":return this.setOnAbort(t,e,s);case"ontimeout":return this.setOnTimeout(t,e,s)}return Reflect.set(t,e,s)}onReadyStateChange(){this.item.url&&this.isServiceUrl(this.item.url)||(this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=performance.now(),this.item.duration=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),setTimeout(()=>{this.item.response=h(this.item.responseType,this.item.response)},0),this.XMLReq.readyState===a.DONE&&this.sendMessage(this.item.getMessage()))}onAbort(){this.item.cancelState=1,this.item.statusText="Abort",this.sendMessage(this.item.getMessage())}onTimeout(){this.item.cancelState=3,this.item.statusText="Timeout",this.sendMessage(this.item.getMessage())}getOpen(n){const i=Reflect.get(n,"open");return(...t)=>{var e=t[0],s=t[1];return this.item.method=e?e.toUpperCase():"GET",this.item.url=s||"",this.item.name=this.item.url.replace(new RegExp("/*$"),"").split("/").pop()||"",this.item.getData=((t,e)=>{ts(e)||(e={});let s=t?t.split("?"):[];if(s.shift(),0<s.length)for(const i of s=s.join("?").split("&")){var n=i.split("=");try{e[n[0]]=decodeURIComponent(n[1])}catch(t){e[n[0]]=n[1]}}return e})(this.item.url,{}),i.apply(n,t)}}getSend(s){const n=Reflect.get(s,"send");return(...t)=>{var e=t[0];return this.item.requestData=Ze(e),n.apply(s,t)}}getSetRequestHeader(e){const s=Reflect.get(e,"setRequestHeader");return(...t)=>(this.item.requestHeader||(this.item.requestHeader={}),this.item.requestHeader[t[0]]=t[1],s.apply(e,t))}setOnReadyStateChange(e,t,s){return Reflect.set(e,t,(...t)=>{this.onReadyStateChange(),s.apply(e,t)})}setOnAbort(e,t,s){return Reflect.set(e,t,(...t)=>{this.onAbort(),s.apply(e,t)})}setOnTimeout(e,t,s){return Reflect.set(e,t,(...t)=>{this.onTimeout(),s.apply(e,t)})}updateItemByReadyState(){switch(this.XMLReq.readyState){case a.UNSENT:case a.OPENED:this.item.status=a.UNSENT,this.item.statusText="Pending",this.item.startTime||(this.item.startTime=performance.now());break;case a.HEADERS_RECEIVED:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};var e=(this.XMLReq.getAllResponseHeaders()||"").split("\n");for(let t=0;t<e.length;t++){var s,n=e[t];n&&(s=(n=n.split(": "))[0],this.item.header[s]=n.slice(1).join(": "))}break;case a.LOADING:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=es(this.item.responseSize));break;case a.DONE:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=es(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}}}class as{static create(e,s,n,i,r){return new Proxy(XMLHttpRequest,{construct(t){t=new t;return new Proxy(t,new os(t,e,s,n,i,r))}})}}function cs(t){return t.__or_req_data__||(t.__or_req_data__={body:void 0,headers:{}}),t.__or_req_data__}function hs(t){return"string"==typeof t?t.toUpperCase():"GET"}function us(l,t={}){const d=Object.assign({failuresOnly:!1,ignoreHeaders:["Cookie","Set-Cookie","Authorization"],capturePayload:!1,sessionTokenHeader:!1,captureInIframes:!0,axiosInstances:void 0,useProxy:!1},t),p=(!1===d.useProxy&&l.debug.warn("Network module is migrating to proxy api, to gradually migrate and test it set useProxy to true"),d.ignoreHeaders),f=Array.isArray(p)?t=>p.includes(t):()=>p,s=!0===d.sessionTokenHeader?"X-OpenReplay-SessionToken":d.sessionTokenHeader;function g(t){var e;s&&(e=l.getSessionToken())&&l.safe(t)(s,e)}function m(t){if(d.capturePayload||(delete t.request.body,delete t.response.body),d.sanitizer){var e=t.response.body;if("string"==typeof e)try{t.response.body=JSON.parse(e)}catch(t){}return d.sanitizer(t)}return t}function v(e){if(e&&"string"!=typeof e.body)try{e.body=JSON.stringify(e.body)}catch(t){e.body="<unable to stringify>",l.notify.warn("Openreplay fetch couldn't stringify body:",e.body)}return JSON.stringify(e)}t=t=>{if(d.useProxy)return e=t,s=d.ignoreHeaders,n=g,i=m,r=t=>l.send(t),o=t=>l.isServiceURL(t),e.XMLHttpRequest=as.create(s,n,i,r,o),void(e.fetch=rs.create(s,n,i,r,o));var e,s,n,i,r,o;const u=t.fetch.bind(t);t.fetch=(a,c={})=>{if(!("string"==typeof a||a instanceof URL)||l.isServiceURL(String(a)))return u(a,c);g(function(t,e){void 0===c.headers&&(c.headers={}),c.headers instanceof Headers?c.headers.append(t,e):Array.isArray(c.headers)?c.headers.push([t,e]):c.headers[t]=e});const h=performance.now();return u(a,c).then(t=>{const r=performance.now()-h;if(!(d.failuresOnly&&t.status<400)){const o=t.clone();o.text().then(t=>{const s={},n={};if(!0!==p){const i=([t,e])=>{f(t)||(s[t]=e)};c.headers instanceof Headers?c.headers.forEach((t,e)=>i([e,t])):Array.isArray(c.headers)?c.headers.forEach(i):"object"==typeof c.headers&&Object.entries(c.headers).forEach(i),o.headers.forEach((t,e)=>{f(e)||(n[e]=t)})}var e=hs(c.method),t=m({url:String(a),method:e,status:o.status,request:{headers:s,body:c.body||null},response:{headers:n,body:t}});t&&l.send(S("fetch",e,String(t.url),v(t.request),v(t.response),o.status,h+M,r))}).catch(t=>l.debug.error("Could not process Fetch response:",t))}return t})};const h=t.XMLHttpRequest.prototype.open,a=t.XMLHttpRequest.prototype.setRequestHeader,c=t.XMLHttpRequest.prototype.send;d.axiosInstances||(t.XMLHttpRequest.prototype.open=function(r,o){const a=this;g((t,e)=>a.setRequestHeader(t,e));let c=0;return a.addEventListener("loadstart",t=>{c=t.timeStamp}),a.addEventListener("load",l.safe(t=>{var{headers:e,body:s}=cs(a),t=0<c?t.timeStamp-c:0,n=(a.getAllResponseHeaders()||"").trim().split(/[\r\n]+/);const i={};n.forEach(function(t){var t=t.split(": "),e=t.shift();f(e)||(i[e]=t.join(": "))});n=hs(r),e=m({url:String(o),method:n,status:a.status,request:{headers:e,body:s||null},response:{headers:i,body:a.response}});e&&l.send(S("xhr",n,String(e.url),v(e.request),v(e.response),a.status,c+M,t))})),h.apply(this,arguments)},t.XMLHttpRequest.prototype.send=function(t){return cs(this).body=t,c.apply(this,arguments)},t.XMLHttpRequest.prototype.setRequestHeader=function(t,e){return f(t)||(cs(this).headers[t]=e),a.apply(this,arguments)})};t(window),d.axiosInstances&&d.axiosInstances.forEach(t=>{Ye(l,t,d,m,v)}),d.captureInIframes&&l.observer.attachContextCallback(l.safe(t))}as.origXMLHttpRequest=XMLHttpRequest;var ls=window&&window.__awaiter||function(t,o,a,c){return new(a=a||Promise)(function(s,e){function n(t){try{r(c.next(t))}catch(t){e(t)}}function i(t){try{r(c.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?s(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,i)}r((c=c.apply(t,o||[])).next())})};class ds{constructor(t){this.app=t,this.flags=[],this.storageKey="__openreplay_flags";var t=this.app.sessionStorage.getItem(this.storageKey);t&&(t=t.split(";").filter(Boolean),this.flags=t.map(t=>JSON.parse(t)))}getFeatureFlag(e){return this.flags.find(t=>t.key===e)}isFlagEnabled(e){return-1!==this.flags.findIndex(t=>t.key===e)}onFlagsLoad(t){this.onFlagsCb=t}reloadFlags(){return ls(this,void 0,void 0,function*(){var t=this.app.sessionStorage.getItem(this.storageKey);const e={};t&&t.split(";").filter(Boolean).forEach(t=>{t=JSON.parse(t);e[t.key]={key:t.key,value:t.value}});var t=this.app.session.getInfo(),s=this.app.session.userInfo,t={projectID:t.projectID,userID:t.userID,metadata:t.metadata,referrer:document.referrer,os:s.userOS,device:s.userDevice,country:s.userCountry,state:s.userState,city:s.userCity,browser:s.userBrowser,persistFlags:e},s=yield fetch(this.app.options.ingestPoint+"/v1/web/feature-flags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.app.session.getSessionToken()},body:JSON.stringify(t)});if(200===s.status)return t=yield s.json(),this.handleFlags(t.flags)})}handleFlags(t){var e;const s=[];t.forEach(t=>{t.is_persist&&s.push(t)});let n="";return this.diffPersist(s).forEach(t=>{n+=JSON.stringify(t)+";"}),this.app.sessionStorage.setItem(this.storageKey,n),this.flags=t,null==(e=this.onFlagsCb)?void 0:e.call(this,t)}clearPersistFlags(){this.app.sessionStorage.removeItem(this.storageKey)}diffPersist(t){var e=this.app.sessionStorage.getItem(this.storageKey);if(!e)return t;const s=e.split(";").filter(Boolean).map(t=>JSON.parse(t));return t.filter(e=>-1===s.findIndex(t=>t.key===e.key))}}const ps="/installation/javascript-sdk";class fs{constructor(e){if(this.options=e,this.app=null,this.handleError=(t,e={})=>{var s;null!==this.app&&(t instanceof Error?(s=Se(t,[],e),this.app.send(s)):(t instanceof ErrorEvent||"PromiseRejectionEvent"in window&&t instanceof PromiseRejectionEvent)&&null!=(s=we(t,void 0,e))&&this.app.send(s))},L&&function(t){if(null!=t){if("string"!=typeof t.projectKey)if("number"!=typeof t.projectKey){if("number"!=typeof t.projectID)return console.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${A}${ps} for more information.`),0;t.projectKey=t.projectID.toString(),j("`projectID` option","`projectKey` option",ps)}else console.warn("OpenReplay: projectKey is expected to have a string type."),t.projectKey=t.projectKey.toString();return null!=t.sessionToken&&j("`sessionToken` option","`sessionHash` start() option","/"),1}console.error("OpenReplay: invalid options argument type. Please, check documentation on "+A+ps)}(e))if(window.__OPENREPLAY__)console.error("OpenReplay: one tracker instance has been initialised already");else if(e.__DISABLE_SECURE_MODE||"https:"===location.protocol){var t,n,s,i=e.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack);const b=this.app=!i&&"Map"in window&&"Set"in window&&"MutationObserver"in window&&"performance"in window&&"timing"in performance&&"startsWith"in String.prototype&&"Blob"in window&&"Worker"in window?new he(e.projectKey,e.sessionToken,e):null;if(null!==b){{var o=b;let e,s,n,i,r=document.referrer;const S=o.safe(()=>{var t=document["URL"];t!==e&&(e=t,o.send([4,e,r,i]),i=0,r=e)}),w=o.safe(()=>{var{innerWidth:t,innerHeight:e}=window;t===s&&e===n||(s=t,n=e,o.send([5,s,n]))}),k=void 0===document.hidden?Function.prototype:o.safe(()=>o.send([55,document.hidden]));o.attachStartCallback(()=>{e="",i=M,s=n=-1,S(),w(),k()}),void 0!==document.hidden&&o.attachEventListener(document,"visibilitychange",k,!1,!1),o.ticker.attach(S,1,!1),o.ticker.attach(w,5,!1)}var a=b;if(null!==a)if(window.CSSStyleSheet){const N=a.safe((t,e,s)=>{t=Ge.get(t);t&&("string"==typeof s?a.send(tt(t,s,e,a.getBaseHref())):a.send(et(t,e)))}),T=a.safe(t=>{let e=t;for(;e.parentRule;)e=e.parentRule;var s,n,i,r=e.parentStyleSheet;r?(s=Ge.get(r))?(n=e.cssText,i=r.cssRules,0<=(i=Array.from(i).indexOf(e))?(a.send(tt(s,n,i,a.getBaseHref())),a.send(et(s,i+1))):a.debug.warn("Rule index not found in",r,e)):a.debug.warn("No sheedID found for",r,Ge):a.debug.warn("No parent StyleSheet found for",e,t)});var r=a.safe(t=>{const{insertRule:s,deleteRule:e}=t.CSSStyleSheet.prototype,{insertRule:n,deleteRule:i}=t.CSSGroupingRule.prototype;t.CSSStyleSheet.prototype.insertRule=function(t,e=0){return N(this,e,t),s.call(this,t,e)},t.CSSStyleSheet.prototype.deleteRule=function(t){return N(this,t),e.call(this,t)},t.CSSGroupingRule.prototype.insertRule=function(t,e=0){t=n.call(this,t,e);return T(this),t},t.CSSGroupingRule.prototype.deleteRule=function(t=0){t=i.call(this,t);return T(this),t}});r(window),a.observer.attachContextCallback(r),a.nodes.attachNodeCallback(t=>{if(P(t,"style")&&t.sheet&&!(null!==t.textContent&&0<t.textContent.trim().length)){var e=a.nodes.getID(t);if(e){var s=t.sheet,t=Ve++,n=(Ge.set(s,t),a.send(st(t,e)),s.cssRules);for(let t=0;t<n.length;t++)N(s,t,n[t].cssText)}}})}else a.send([63,"no_stylesheet_prototype_in_window",""]);var c=b;if(null!==c&&Ke(document)){const E=new Map,O=new Map,I=a=>setTimeout(()=>{let s=c.nodes.getID(a);if(void 0!==(s=a===document?0:s)){let t=O.get(s);t=t||[];var n=[];for(const o of a.adoptedStyleSheets){let e=E.get(o);var i=!e;if(e||(e=Ve++,E.set(o,e)),t.includes(e)||c.send(st(e,s)),i){var r=o.cssRules;for(let t=0;t<r.length;t++)c.send(tt(e,r[t].cssText,t,c.getBaseHref()))}n.push(e)}for(const e of t)n.includes(e)||c.send([77,e,s]);O.set(s,n)}},20);r=t=>{if(!t.__openreplay_adpss_patched__){t.__openreplay_adpss_patched__=!0,h(t.Document.prototype),h(t.ShadowRoot.prototype);const{replace:e,replaceSync:s}=t.CSSStyleSheet.prototype;t.CSSStyleSheet.prototype.replace=function(s){return e.call(this,s).then(t=>{var e=E.get(this);return e&&c.send(Z(e,s,c.getBaseHref())),t})},t.CSSStyleSheet.prototype.replaceSync=function(t){var e=E.get(this);return e&&c.send(Z(e,t,c.getBaseHref())),s.call(this,t)}}};function h(t){const e=Object.getOwnPropertyDescriptor(t,"adoptedStyleSheets");e&&Object.defineProperty(t,"adoptedStyleSheets",Object.assign(Object.assign({},e),{set:function(t){t=e.set.call(this,t);return I(this),t}}))}r(window),c.observer.attachContextCallback(c.safe(r)),c.attachStopCallback(()=>{E.clear(),O.clear()}),c.attachStartCallback(()=>{I(document)}),c.nodes.attachNodeCallback(t=>{Ke(t)&&I(t)})}{var u=b;const _=navigator.connection||navigator.mozConnection||navigator.webkitConnection;void 0!==_&&((d=()=>u.send([54,Math.round(1e3*_.downlink),_.type||"unknown"]))(),_.addEventListener("change",d))}ge(b,e),s=b,Object.assign({captureExceptions:!0},e).captureExceptions&&(s.observer.attachContextCallback(y),y(window)),Ne(b),Ie(b,e),We(b,e.mouse),Xe(b,e);var l=b,d=e;if(Object.assign({capturePerformance:!0},d).capturePerformance){let t,e;const R=()=>{void 0!==t&&-1!==t&&(t++,requestAnimationFrame(R))},D=(l.ticker.attach(()=>{void 0!==e&&-1!==e&&e++},0,!1),()=>{void 0!==t&&void 0!==e&&(l.send([49,t,e,ee.memory.totalJSHeapSize||0,ee.memory.usedJSHeapSize||0]),e=t=document.hidden?-1:0)});l.attachStartCallback(()=>{e=t=-1,D(),R()}),l.attachStopCallback(()=>{e=t=void 0}),l.ticker.attach(D,40,!1),void 0!==document.hidden&&l.attachEventListener(document,"visibilitychange",D,!1,!1)}Je(b);{var p=b;function f(t){t=p.nodes.getID(t);void 0!==t&&p.send(Q(t))}let e=!1;p.nodes.attachNodeCallback(t=>{P(t,"body")&&(p.nodes.attachNodeListener(t,"focus",t=>{rt(t.target)&&(f(t.target),e=!1)}),p.nodes.attachNodeListener(t,"blur",t=>{null===t.relatedTarget&&(e=!0,setTimeout(()=>{e&&p.send(Q(-1))},0))}))}),p.attachStartCallback(()=>{let t=document.activeElement;for(;t&&P(t,"iframe")&&t.contentDocument;)t=t.contentDocument.activeElement;t&&t!==t.ownerDocument.body&&f(t)},!0)}var g=b;if(window.FontFace){const C=new Map;var m=i=>{class t extends i.FontFace{constructor(...e){if("string"==typeof e[1]){let t="";e[2]&&g.safe(()=>{t=JSON.stringify(e[2])});var s=[e[0],e[1],t],n=C.get(i.document)||[],n=(n.push(s),C.set(i.document,n),i===window?0:g.nodes.getID(i.document));if(void 0===n)return;g.active()&&g.send(Y(n,...s))}super(...e)}}i.FontFace=t};g.observer.attachContextCallback(m),m(window),g.nodes.attachNodeCallback(g.safe(t=>{if(H(t)){var e=C.get(t);if(e){const s=t.defaultView===window?0:g.nodes.getID(t);void 0!==s&&e.forEach(t=>{g.send(Y(s,...t))})}}}))}if(us(b,e.network),(n=b).attachEventListener(document,"selectionchange",()=>{var t,e,s=document.getSelection();null===s||s.isCollapsed?n.send(nt(-1,-1,"")):(t=n.nodes.getID(s.anchorNode),e=n.nodes.getID(s.focusNode),s=s.toString().replace(/\s+/g," "),t&&e&&n.send(nt(t,e,s)))}),(t=b).attachEventListener(window,"focus",function(){document.hidden||(t.debug.log("Openreplay: tab change to"+t.session.getTabId()),t.send(it(t.session.getTabId())))},!1,!1),this.featureFlags=new ds(b),window.__OPENREPLAY__=this,b.attachStartCallback(()=>{var t;null!=(t=e.flags)&&t.onFlagsLoad&&this.onFlagsLoad(e.flags.onFlagsLoad),this.featureFlags.reloadFlags()}),e.autoResetOnWindowOpen){const x=window.open;b.attachStartCallback(()=>{window.open=function(...t){b.resetNextPageSession(!0),x.call(window,...t),b.resetNextPageSession(!1)}}),b.attachStopCallback(()=>{window.open=x})}}else{console.log("OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1.");var m=new XMLHttpRequest,v=e.ingestPoint||ce;m.open("POST",v+"/v1/web/not-started"),m.send(JSON.stringify({trackerVersion:"9.0.0",projectKey:e.projectKey,doNotTrack:i}))}function y(e){function t(t){t=we(t,e);null!=t&&s.send(t)}s.attachEventListener(e,"unhandledrejection",t),s.attachEventListener(e,"error",t)}}else console.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.")}isFlagEnabled(t){return this.featureFlags.isFlagEnabled(t)}onFlagsLoad(t){this.featureFlags.onFlagsLoad(t)}clearPersistFlags(){this.featureFlags.clearPersistFlags()}reloadFlags(){return this.featureFlags.reloadFlags()}getFeatureFlag(t){return this.featureFlags.getFeatureFlag(t)}getAllFeatureFlags(){return this.featureFlags.flags}use(t){return t(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}start(t){return L?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(t):(console.error("OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the `tracker.start()` line. Check documentation on "+A+ps),Promise.reject("Trying to start not in browser."))}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}forceFlushBatch(){null!==this.app&&this.app.forceFlushBatch()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionID(){return null===this.app?null:this.app.getSessionID()}getTabId(){return null===this.app?null:this.app.getTabId()}sessionID(){return j("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(t){if(null!==this.app)return this.app.getSessionURL(t)}setUserID(t){"string"==typeof t&&null!==this.app&&this.app.session.setUserID(t)}userID(t){j("'userID' method","'setUserID' method","/"),this.setUserID(t)}setUserAnonymousID(t){"string"==typeof t&&null!==this.app&&this.app.send([29,t])}userAnonymousID(t){j("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(t)}setMetadata(t,e){"string"==typeof t&&"string"==typeof e&&null!==this.app&&this.app.session.setMetadata(t,e)}metadata(t,e){j("'metadata' method","'setMetadata' method","/"),this.setMetadata(t,e)}event(t,e=null,s=!1){if("string"==typeof t&&null!==this.app){if(s)return this.issue(t,e);try{e=JSON.stringify(e)}catch(t){return}this.app.send([27,t,e])}}issue(t,e=null){if("string"==typeof t&&null!==this.app){try{e=JSON.stringify(e)}catch(t){return}this.app.send([64,t,e])}}}!function(t){var t=0<arguments.length&&void 0!==t?t:{},e=window.OpenReplay||window.asayer,s=e.shift(),n=e.shift(),i=e.shift(),s=("object"===l(i="number"==typeof i?{obscureTextEmails:!!(1&i),obscureTextNumbers:!!(i>>1&1),obscureInputNumbers:!!(i>>3&1),obscureInputEmails:!!(i>>4&1),defaultInputMode:i>>5}:i)&&null!==i||(i={}),Object.assign({projectKey:s,sessionToken:n},i,t,{__is_snippet:!0})),r=(e.i&&(s.ingestPoint=e.i),window.OpenReplay=window.asayer=new fs(s)),o=r.setUserID.bind(r),a=(r.setUserID=r.userID=function(t){void 0!==l(t)&&null!==t&&o(t.toString())},r.setUserAnonymousID.bind(r)),c=(r.setUserAnonymousID=r.userAnonymousID=function(t){void 0!==l(t)&&null!==t&&a(t.toString())},r.setMetadata.bind(r)),h=(r.setMetadata=r.metadata=function(t,e){"number"==typeof e&&NaN!==e&&(e=e.toString()),"string"==typeof t&&"string"==typeof e&&c(t,e)},r.event.bind(r));for(r.event=function(t,e){"string"==typeof t&&h(t,e)};e.length;){var u=e.shift();switch(u[0]){case 0:r.start(u[1]);break;case 1:r.stop();break;case 2:r.setUserID(u[1]);break;case 3:r.setUserAnonymousID(u[1]);break;case 4:r.setMetadata(u[1],u[2]);break;case 5:r.event(u[1],u[2],u[3]);break;case 6:r.issue(u[1],u[2])}}}()}();
